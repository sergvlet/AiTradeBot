<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<body>

<!-- –§–†–ê–ì–ú–ï–ù–¢ –î–ê–®–ë–û–†–î–ê -->
<div th:fragment="content"
     th:with="type=${type},
              chatId=${chatId},
              symbol=${symbol},
              info=${info}">

    <!-- üëá –ö–æ—Ä–Ω–µ–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è JS -->
    <div id="strategy-root"
         th:attr="data-chat-id=${chatId},
                  data-type=${type},
                  data-symbol=${symbol}">
    </div>


    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-1 d-flex align-items-center gap-2">
                <i class="bi bi-graph-up"></i>
                <span th:text="${type}">STRATEGY</span> ‚Äî –î–∞—à–±–æ—Ä–¥
            </h2>

            <div class="text-secondary">
                –°–∏–º–≤–æ–ª: <span class="fw-semibold" th:text="${symbol}">BTCUSDT</span>
            </div>
        </div>

        <div>
            <span class="badge px-3 py-2"
                  th:classappend="${info?.active} ? ' bg-success' : ' bg-danger'">
                <span th:text="${info?.active} ? 'üü¢ –†–∞–±–æ—Ç–∞–µ—Ç' : 'üî¥ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞'">‚Äî</span>
            </span>

            <button id="btn-start"
                    class="btn btn-outline-success ms-2"
                    th:classappend="${info?.active} ? ' d-none' : ''"
                    th:data-type="${type}"
                    th:data-chat-id="${chatId}">
                <i class="bi bi-play-fill"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å
            </button>

            <button id="btn-stop"
                    class="btn btn-outline-danger ms-2"
                    th:classappend="${info?.active} ? '' : ' d-none'"
                    th:data-type="${type}"
                    th:data-chat-id="${chatId}">
                <i class="bi bi-stop-fill"></i> –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
            </button>
        </div>
    </div>


    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card card-theme p-3">
                <div class="small-label">ROI</div>
                <div class="fs-4 fw-bold"
                     th:classappend="${info?.totalProfitPct >= 0} ? ' text-success' : ' text-danger'"
                     th:text="${info?.totalProfitPct != null ? info.totalProfitPct + '%' : '‚Äî'}">
                </div>
                <div class="text-secondary small">–û–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card card-theme p-3">
                <div class="small-label">–ö–∞–ø–∏—Ç–∞–ª</div>
                <div class="fs-4 fw-bold text-info"
                     th:text="${info?.equityUsd != null ? info.equityUsd : '‚Äî'}">
                </div>
                <div class="text-secondary small">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card card-theme p-3">
                <div class="small-label">AI Confidence</div>
                <div class="fs-4 fw-bold"
                     th:text="${info?.mlConfidence != null ? info.mlConfidence : '‚Äî'}">
                </div>
                <div class="text-secondary small">–£—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ AI</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card card-theme p-3">
                <div class="small-label">–°–¥–µ–ª–∫–∏</div>
                <div class="fs-4 fw-bold"
                     th:text="${info?.totalTrades != null ? info.totalTrades : 0}">
                </div>
                <div class="text-secondary small">–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</div>
            </div>
        </div>
    </div>


    <!-- –ì—Ä–∞—Ñ–∏–∫ -->
    <div class="card card-theme p-3 mb-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">
                <i class="bi bi-bar-chart-line me-2"></i>–ì—Ä–∞—Ñ–∏–∫ —Ü–µ–Ω—ã
            </h5>

            <div class="small">
                <span class="text-secondary">WS:</span>
                <span id="chart-ws-status" class="fw-bold text-danger">OFFLINE</span>
            </div>
        </div>

        <!-- –í–ê–ñ–ù–û: –í–ù–£–¢–†–ï–ù–ù–ò–ô DIV –î–õ–Ø CHART -->
        <div id="strategy-chart-container" style="height: 400px;">
            <div id="strategy-chart" style="width:100%; height:100%;"></div>
        </div>
    </div>


    <!-- –ù–∏–∂–Ω–∏–µ –±–ª–æ–∫–∏ -->
    <div class="row g-4">

        <!-- –¢—Ä–µ–π–¥—ã -->
        <div class="col-lg-7">
            <div class="card card-theme p-3 h-100">

                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0"><i class="bi bi-list-check me-2"></i>–ñ—É—Ä–Ω–∞–ª —Å–¥–µ–ª–æ–∫</h5>

                    <span class="badge bg-info">
                        PnL:
                        <span th:text="${info?.totalProfitPct != null ? info.totalProfitPct + '%' : '0%'}"></span>
                    </span>
                </div>

                <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                    <table class="table table-dark-custom table-sm mb-0">
                        <thead>
                        <tr>
                            <th class="text-secondary small">–í—Ä–µ–º—è</th>
                            <th class="text-secondary small">–¢–∏–ø</th>
                            <th class="text-secondary small">–¶–µ–Ω–∞</th>
                            <th class="text-secondary small">–û–±—ä—ë–º</th>
                            <th class="text-secondary small">–ü—Ä–æ—Ñ–∏—Ç</th>
                        </tr>
                        </thead>
                        <tbody id="trades-body">
                        <tr>
                            <td colspan="5" class="text-center text-secondary small py-4">
                                –ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>


        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="col-lg-5">
            <div class="card card-theme p-3 h-100">

                <h5 class="mb-3"><i class="bi bi-gear me-2"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h5>

                <ul class="list-unstyled small">
                    <li class="mb-2">–°–∏–º–≤–æ–ª: <span class="fw-bold" th:text="${symbol}">BTCUSDT</span></li>
                    <li class="mb-2">–¢–∞–π–º—Ñ—Ä–µ–π–º: <span class="fw-bold" th:text="${info?.timeframe}">1m</span></li>
                    <li class="mb-2">TP: <span class="fw-bold" th:text="${info?.takeProfitPct + '%'}">‚Äî</span></li>
                    <li class="mb-2">SL: <span class="fw-bold" th:text="${info?.stopLossPct + '%'}">‚Äî</span></li>
                    <li class="mb-2">–ö–æ–º–∏—Å—Å–∏—è: <span class="fw-bold" th:text="${info?.commissionPct + '%'}">‚Äî</span></li>
                    <li class="mb-2">–†–∏—Å–∫/—Å–¥–µ–ª–∫–∞: <span class="fw-bold" th:text="${info?.riskPerTradePct + '%'}">‚Äî</span></li>
                </ul>

                <a class="btn btn-outline-primary w-100 mt-3"
                   th:href="@{'/strategies/' + ${type} + '/config'(chatId=${chatId})}">
                    <i class="bi bi-pencil-square me-2"></i>–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
                </a>

            </div>
        </div>

    </div>

</div>

</body>
</html>
