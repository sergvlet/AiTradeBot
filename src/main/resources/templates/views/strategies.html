<!doctype html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<body>

<div th:fragment="content">

    <h2 class="fw-bold mb-4 d-flex align-items-center gap-2">
        <i class="bi bi-diagram-3"></i>
        <span>–°—Ç—Ä–∞—Ç–µ–≥–∏–∏</span>
    </h2>

    <div class="row g-4">

        <!-- –û–î–ù–ê –ö–ê–†–¢–û–ß–ö–ê –ù–ê –°–¢–†–ê–¢–ï–ì–ò–Æ -->
        <div class="col-md-4 col-sm-6"
             th:each="s : ${strategies}"
             th:with="
                symbolSafe=${s.symbol != null ? #strings.trim(s.symbol) : ''},
                tfSafe=${s.timeframe != null ? #strings.trim(s.timeframe) : ''},
                hasSymbol=${!#strings.isEmpty(symbolSafe)},
                hasTimeframe=${!#strings.isEmpty(tfSafe)},
                configured=${hasSymbol and hasTimeframe},
                exSafe=${s.exchangeName != null ? s.exchangeName : 'BINANCE'},
                netSafe=${s.networkType != null ? s.networkType : 'MAINNET'}
             ">

            <div class="card card-theme strategy-card h-100 shadow-sm"
                 th:classappend="${s.active} ? ' border-success border-2' : ''">

                <div class="card-body text-center">

                    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ -->
                    <h5 class="strategy-title mb-2" th:text="${s.title}">Strategy</h5>

                    <!-- –°—Ç–∞—Ç—É—Å—ã -->
                    <div class="d-flex justify-content-center gap-2 flex-wrap mb-2">

                        <span class="badge px-3 py-2"
                              th:classappend="${s.active} ? ' bg-success' : ' bg-secondary'">
                            <span th:text="${s.active} ? 'üü¢ –ê–∫—Ç–∏–≤–Ω–∞' : '‚ö´ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞'">‚ö´ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</span>
                        </span>

                        <!-- ‚ö† –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ -->
                        <span th:if="${!configured}"
                              class="badge px-3 py-2 bg-warning text-dark">
                            ‚ö† –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
                        </span>

                    </div>

                    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                    <div class="small text-secondary mb-3" th:text="${s.description}">
                        –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
                    </div>

                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–∞ -->
                    <div class="small text-start">
                        <div>
                            <strong>–ë–∏—Ä–∂–∞:</strong>
                            <span th:text="${exSafe}">BINANCE</span>
                        </div>
                        <div>
                            <strong>–°–µ—Ç—å:</strong>
                            <span th:text="${netSafe}">MAINNET</span>
                        </div>
                        <div>
                            <strong>–ü–∞—Ä–∞:</strong>
                            <span th:text="${hasSymbol ? symbolSafe : '‚Äî –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ ‚Äî'}">BTCUSDT</span>
                        </div>
                        <div>
                            <strong>–¢–∞–π–º—Ñ—Ä–µ–π–º:</strong>
                            <span th:text="${hasTimeframe ? tfSafe : '‚Äî –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ ‚Äî'}">1m</span>
                        </div>
                        <div>
                            <strong>–†–µ–∂–∏–º:</strong>
                            <span th:text="${s.advancedControlMode != null ? s.advancedControlMode : '‚Äî'}">MANUAL</span>
                        </div>
                    </div>

                    <!-- –ö–ù–û–ü–ö–ò -->
                    <div class="mt-4 d-grid gap-2">

                        <!-- üîÅ TOGGLE (FORM, –ù–ï JS) -->
                        <form method="post" th:action="@{/strategies/toggle}">
                            <input type="hidden" name="chatId"   th:value="${s.chatId}">
                            <input type="hidden" name="type"     th:value="${s.type}">
                            <input type="hidden" name="exchange" th:value="${exSafe}">
                            <input type="hidden" name="network"  th:value="${netSafe}">

                            <!-- –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–∞ ‚Äî –¥–∞—ë–º –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ–≥–¥–∞ -->
                            <button th:if="${s.active}"
                                    type="submit"
                                    class="btn btn-outline-danger">
                                <i class="bi bi-stop-fill"></i>
                                <span>–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</span>
                            </button>

                            <!-- –µ—Å–ª–∏ –ù–ï –∞–∫—Ç–∏–≤–Ω–∞ ‚Äî –∑–∞–ø—É—Å–∫ —Ä–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ -->
                            <button th:if="${!s.active}"
                                    type="submit"
                                    class="btn btn-outline-success"
                                    th:disabled="${!configured}"
                                    th:attr="title=${configured} ? '–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é' : '–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π —Å–∏–º–≤–æ–ª –∏ —Ç–∞–π–º—Ñ—Ä–µ–π–º'">
                                <i class="bi bi-play-fill"></i>
                                <span th:text="${configured} ? '–ó–∞–ø—É—Å—Ç–∏—Ç—å' : '–ó–∞–ø—É—Å—Ç–∏—Ç—å (—Å–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π)'">
                                    –ó–∞–ø—É—Å—Ç–∏—Ç—å
                                </span>
                            </button>
                        </form>

                        <!-- üìä –î–∞—à–±–æ—Ä–¥ (–í–°–ï–ì–î–ê –≤–µ–¥—ë—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É; –µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ ‚Äî —Ç–∞–º –ø–æ–∫–∞–∂–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ) -->
                        <a class="btn btn-outline-primary"
                           th:href="@{'/strategies/' + ${s.type} + '/dashboard'(chatId=${s.chatId})}"
                           th:attr="title=${configured} ? '–û—Ç–∫—Ä—ã—Ç—å –¥–∞—à–±–æ—Ä–¥' : '–°—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ–¥—Å–∫–∞–∑–∫–∞'">
                            <i class="bi bi-graph-up"></i>
                            <span th:text="${configured} ? '–î–∞—à–±–æ—Ä–¥' : '–î–∞—à–±–æ—Ä–¥ (–Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)'">–î–∞—à–±–æ—Ä–¥</span>
                        </a>

                        <!-- ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã) -->
                        <a class="btn btn-outline-primary"
                           th:href="@{'/strategies/' + ${s.type} + '/config'(
                                chatId=${s.chatId},
                                exchange=${exSafe},
                                network=${netSafe}
                           )}">
                            <i class="bi bi-gear"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                        </a>

                    </div>

                </div>
            </div>

        </div>

    </div>

</div>

</body>
</html>
