<div th:fragment="content"
     class="container py-4 strategy-settings-page"
     th:attr="
        data-chat-id=${chatId},
        data-type=${type},
        data-exchange=${selectedExchange},
        data-network=${selectedNetwork}
     ">



    <link rel="stylesheet" th:href="@{/css/views/strategies/settings.css}"/>

    <h2 class="fw-bold mb-4">
        <i class="bi bi-gear-wide-connected"></i>
        –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ ‚Äî <span th:text="${type}">TYPE</span>
    </h2>

    <hr class="my-4"/>

    <!-- ====================== –¢–ê–ë–´ ====================== -->
    <ul class="nav nav-tabs mb-3">
        <li class="nav-item"><span class="nav-link tab-btn active" data-tab="tab-network">–°–µ—Ç—å</span></li>
        <li class="nav-item"><span class="nav-link tab-btn" data-tab="tab-general">–û–±—â–∏–µ</span></li>
        <li class="nav-item"><span class="nav-link tab-btn" data-tab="tab-risk">–†–∏—Å–∫</span></li>
        <li class="nav-item"><span class="nav-link tab-btn" data-tab="tab-trade">–¢–æ—Ä–≥–æ–≤–ª—è</span></li>
        <li class="nav-item"><span class="nav-link tab-btn" data-tab="tab-advanced">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ</span></li>
    </ul>

    <!-- ===================================================== -->
    <!-- TAB: NETWORK  (–í–ê–ñ–ù–û: –û–¢–î–ï–õ–¨–ù–´–ï –§–û–†–ú–´, –ù–ï –í–õ–û–ñ–ï–ù–ù–´–ï)   -->
    <!-- ===================================================== -->
    <div class="tab-pane active" id="tab-network">

        <div class="card card-theme p-4">

            <!-- ===================================================== -->
            <!-- 1) –ë–ò–†–ñ–ê + –°–ï–¢–¨ -->
            <!-- ===================================================== -->
            <div class="section-title">–ë–∏—Ä–∂–∞ –∏ —Å–µ—Ç—å</div>

            <form method="post"
                  th:action="@{|/strategies/${type}/config?chatId=${chatId}|}">


                <input type="hidden" name="saveScope" value="network"/>
                <input type="hidden" name="tab" value="network"/>

                <div class="row g-4">

                    <!-- –ë–∏—Ä–∂–∞ -->
                    <div class="col-md-4">
                        <label class="form-label">–ë–∏—Ä–∂–∞</label>
                        <select id="exchangeSelect"
                                class="form-control"
                                name="exchange">
                            <option th:each="ex : ${availableExchanges}"
                                    th:value="${ex}"
                                    th:text="${ex}"
                                    th:selected="${selectedExchange == ex}">
                            </option>
                        </select>
                    </div>

                    <!-- –°–µ—Ç—å -->
                    <div class="col-md-4">
                        <label class="form-label">–°–µ—Ç—å</label>
                        <select id="networkSelect"
                                class="form-control"
                                name="network">
                            <option value="MAINNET"
                                    th:selected="${selectedNetwork?.name() == 'MAINNET'}">
                                MAINNET
                            </option>
                            <option value="TESTNET"
                                    th:selected="${selectedNetwork?.name() == 'TESTNET'}">
                                TESTNET
                            </option>
                        </select>
                    </div>

                    <!-- –°—Ç–∞—Ç—É—Å -->
                    <div class="col-md-4 d-flex flex-column justify-content-end">
                        <div class="fw-bold mb-1"
                             th:classappend="${connectionOk} ? 'text-success' : 'text-danger'">
                            <span th:text="${connectionOk} ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è'"></span>
                        </div>

                        <div>
                            <span class="badge bg-success"
                                  th:if="${exchangeSettings != null and exchangeSettings.hasKeys()}">
                                –ö–ª—é—á–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
                            </span>
                            <span class="badge bg-secondary"
                                  th:if="${exchangeSettings == null or !exchangeSettings.hasKeys()}">
                                –ö–ª—é—á–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã
                            </span>
                        </div>
                    </div>

                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ -->
                <div class="d-flex gap-2 mt-4">
                    <a th:href="@{/strategies(chatId=${chatId})}"
                       class="btn btn-outline-secondary">
                        ‚óÄ –ù–∞–∑–∞–¥
                    </a>

                    <div class="ms-auto">
                        <button type="submit"
                                class="btn btn-primary">
                            ‚úî –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ¬´–°–µ—Ç—å¬ª
                        </button>
                    </div>
                </div>

            </form>

            <!-- ===================================================== -->
            <!-- 2) –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê (AJAX, –ë–ï–ó save) -->
            <!-- ===================================================== -->
            <div class="section-title mt-4">–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ API</div>

            <div id="diagnostics-box">

                <div class="d-flex align-items-center gap-2 mb-2">
                    <button type="button"
                            id="btn-diagnose"
                            class="btn btn-outline-info btn-sm"
                            th:data-chat-id="${chatId}"
                            th:data-exchange="${selectedExchange}"
                            th:data-network="${selectedNetwork}">
                        üîç –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
                    </button>

                    <span id="diag-status" class="text-secondary small">
                        –ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É¬ª.
                    </span>
                </div>

                <div id="diag-not-supported"
                     class="text-warning"
                     style="display:none;">
                    –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è Binance –∏ Bybit.
                </div>

                <table id="diag-table"
                       class="table table-dark table-bordered align-middle text-center mt-2"
                       style="max-width:600px; display:none;">
                    <tbody>
                    <tr><td>API Key –≤–∞–ª–∏–¥–µ–Ω</td><td id="d-apiKeyValid">‚Äî</td></tr>
                    <tr><td>Secret –≤–∞–ª–∏–¥–µ–Ω</td><td id="d-secretValid">‚Äî</td></tr>
                    <tr><td>–ü–æ–¥–ø–∏—Å—å</td><td id="d-signatureValid">‚Äî</td></tr>
                    <tr><td>–î–æ—Å—Ç—É–ø –∫ –∞–∫–∫–∞—É–Ω—Ç—É</td><td id="d-accountReadable">‚Äî</td></tr>
                    <tr><td>–†–∞–∑—Ä–µ—à–µ–Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—è</td><td id="d-tradingAllowed">‚Äî</td></tr>
                    <tr><td>IP —Ä–∞–∑—Ä–µ—à—ë–Ω</td><td id="d-ipAllowed">‚Äî</td></tr>
                    <tr><td>–°–µ—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞</td><td id="d-networkOk">‚Äî</td></tr>
                    </tbody>
                </table>

                <div id="diag-message"
                     class="text-secondary mt-2"
                     style="display:none;"></div>

            </div>

            <!-- ===================================================== -->
            <!-- 3) API –ö–õ–Æ–ß–ò -->
            <!-- ===================================================== -->
            <div class="section-title mt-4">API –∫–ª—é—á–∏</div>

            <form method="post"
                  th:action="@{|/strategies/${type}/config?chatId=${chatId}|}">

                <input type="hidden" name="saveScope" value="keys"/>
                <input type="hidden" name="tab" value="network"/>

                <input type="hidden" name="exchange" th:value="${selectedExchange}"/>
                <input type="hidden" name="network" th:value="${selectedNetwork?.name()}"/>

                <div class="row g-4">

                    <div class="col-md-4">
                        <label class="form-label">API Key</label>
                        <input class="form-control"
                               name="apiKey"
                               type="password"
                               autocomplete="off"
                               placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        <div class="form-text text-secondary">
                            –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –º–µ–Ω—è—Ç—å.
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">API Secret</label>
                        <input class="form-control"
                               name="apiSecret"
                               type="password"
                               autocomplete="off"
                               placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        <div class="form-text text-secondary">
                            –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –º–µ–Ω—è—Ç—å.
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Passphrase</label>
                        <input class="form-control"
                               name="passphrase"
                               type="password"
                               autocomplete="off"
                               placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        <div class="form-text text-secondary">
                            –ù—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±–∏—Ä–∂ (–Ω–∞–ø—Ä–∏–º–µ—Ä OKX).
                        </div>
                    </div>

                </div>

                <div class="d-flex gap-2 mt-4">
                    <div class="ms-auto">
                        <button type="submit"
                                class="btn btn-primary">
                            ‚úî –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ¬´–ö–ª—é—á–∏¬ª
                        </button>
                    </div>
                </div>

            </form>

        </div>
    </div>

    <!-- ===================================================== -->
    <!-- NETWORK TAB: JS -->
    <!-- ===================================================== -->
    <script src="/js/strategies/network.tab.js"></script>

    <!-- ===================================================== -->
    <!-- –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô FORM –î–õ–Ø: GENERAL / RISK / TRADE / ADV   -->
    <!-- ===================================================== -->
    <form method="post"
          th:object="${strategy}"
          th:action="@{|/strategies/${type}/config?chatId=${chatId}|}"
          class="card card-theme p-4">

        <!-- ‚úÖ FIX: –î–û–ë–ê–í–õ–ï–ù–û, –ù–ò–ß–ï–ì–û –î–†–£–ì–û–ì–û –ù–ï –ú–ï–ù–Ø–õ–û–°–¨ -->
        <input type="hidden" name="exchange" th:value="${selectedExchange}"/>
        <input type="hidden" name="network" th:value="${selectedNetwork}"/>

        <!-- ====================== GENERAL TAB ================== -->
        <div class="tab-pane" id="tab-general">

            <div class="section-title">–ë–∞–ª–∞–Ω—Å –∞–∫–∫–∞—É–Ω—Ç–∞</div>

            <div class="row g-4">

                <!-- üí∞ –î–û–°–¢–£–ü–ù–û –°–†–ï–î–°–¢–í -->
                <div class="col-md-4">
                    <label class="form-label">–î–æ—Å—Ç—É–ø–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤</label>
                    <div class="input-group">
                        <input class="form-control" readonly
                               th:value="${availableBalance != null ? availableBalance : '‚Äî'}">
                        <span class="input-group-text"
                              th:text="${selectedAsset != null ? selectedAsset : '‚Äî'}">
                USDT
            </span>
                    </div>
                    <div class="form-text">
                        –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å –Ω–∞ –±–∏—Ä–∂–µ (free).
                    </div>
                </div>

                <!-- üí± –í–´–ë–û–† –ê–ö–¢–ò–í–ê (AJAX, –ë–ï–ó SUBMIT) -->
                <div class="col-md-4">
                    <label class="form-label">–ê–∫—Ç–∏–≤ —Å—á—ë—Ç–∞</label>

                    <select id="accountAssetSelect"
                            class="form-select"
                            th:disabled="${#lists.isEmpty(availableAssets)}"
                            th:data-chat-id="${chatId}"
                            th:data-type="${type}"
                            th:data-exchange="${selectedExchange}"
                            th:data-network="${selectedNetwork}">

                        <option th:if="${#lists.isEmpty(availableAssets)}" value="">‚Äî</option>

                        <option th:each="asset : ${availableAssets}"
                                th:value="${asset}"
                                th:text="${asset}"
                                th:selected="${asset == selectedAsset}">
                        </option>
                    </select>

                    <div class="form-text">
                        –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤—ã —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º.
                    </div>
                </div>




            </div>


            <hr class="my-4"/>

            <div class="section-title">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤</div>

            <div class="row g-4">
                <div class="col-md-4">
                    <label class="form-label">–ú–∞–∫—Å–∏–º—É–º –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ (USDT)</label>
                    <input type="number" step="1"
                           class="form-control"
                           name="maxExposureUsd"
                           placeholder="–ù–∞–ø—Ä. 500">
                    <div class="form-text">
                        –ë–æ—Ç –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ —ç—Ç–æ–π —Å—É–º–º—ã.
                    </div>
                </div>

                <div class="col-md-4">
                    <label class="form-label">–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (%)</label>
                    <input type="number" step="1"
                           class="form-control"
                           name="maxExposurePct"
                           placeholder="–ù–∞–ø—Ä. 50">
                    <div class="form-text">
                        –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞.
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="alert alert-info small mt-4">
                        –ï—Å–ª–∏ –∑–∞–¥–∞–Ω—ã –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ.
                    </div>
                </div>
            </div>

            <hr class="my-4"/>

            <div class="section-title">–ü—Ä–∏–±—ã–ª—å</div>

            <div class="row g-4">
                <div class="col-md-4">

                    <div class="form-check">

                        <input class="form-check-input"
                               type="checkbox"
                               id="reinvestProfit"
                               name="reinvestProfit"
                               value="true"
                               th:checked="${strategy.reinvestProfit}"/>

                        <label class="form-check-label" for="reinvestProfit">
                            –†–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–±—ã–ª—å
                        </label>


                    </div>

                    <div class="form-text">
                        –ü—Ä–∏–±—ã–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–¥–µ–ª–∫–∞—Ö.
                    </div>

                </div>
            </div>






            <hr class="my-4"/>

            <div class="section-title">–ö–æ–º–∏—Å—Å–∏–∏ –±–∏—Ä–∂–∏</div>

            <div class="row g-4">
                <div class="col-md-4">
                    <label class="form-label">–ö–æ–º–∏—Å—Å–∏—è Maker</label>
                    <input class="form-control" readonly
                           th:value="${accountFees?.makerPct != null ? accountFees.makerPct : '‚Äî'}">
                </div>

                <div class="col-md-4">
                    <label class="form-label">–ö–æ–º–∏—Å—Å–∏—è Taker</label>
                    <input class="form-control" readonly
                           th:value="${accountFees?.takerPct != null ? accountFees.takerPct : '‚Äî'}">
                </div>

                <div class="col-md-4">
                    <div class="alert alert-secondary small mt-4">
                        –ö–æ–º–∏—Å—Å–∏–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è —Å –±–∏—Ä–∂–∏ –∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-end mt-4">
                <button type="submit"
                        class="btn btn-primary"
                        name="saveScope"
                        value="general">
                    ‚úî –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ¬´–û–±—â–∏–µ¬ª
                </button>
            </div>
        </div>

        <!-- ====================== RISK TAB ===================== -->
        <div class="tab-pane" id="tab-risk">

            <div class="section-title">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ—Ç–µ—Ä—å</div>

            <div class="row g-4">
                <div class="col-md-4">
                    <label class="form-label">
                        –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –∑–∞ –¥–µ–Ω—å (%)
                        <span class="badge bg-secondary ms-1">–õ–∏–º–∏—Ç</span>
                    </label>
                    <input type="number" step="0.1"
                           class="form-control"
                           name="dailyLossLimitPct"
                           th:value="${strategy.dailyLossLimitPct}">
                    <div class="form-text">
                        –ï—Å–ª–∏ —Å—É–º–º–∞—Ä–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –∑–∞ –¥–µ–Ω—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî
                        –±–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç —Ç–æ—Ä–≥–æ–≤–ª—é –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è.
                    </div>
                </div>

                <div class="col-md-4">
                    <label class="form-label">
                        –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –Ω–∞ –æ–¥–Ω—É —Å–¥–µ–ª–∫—É (%)
                        <span class="badge bg-info ms-1">AI</span>
                    </label>
                    <input type="number" step="0.1"
                           class="form-control"
                           name="riskPerTradePct"
                           th:value="${strategy.riskPerTradePct}">
                    <div class="form-text">
                        –í–µ—Ä—Ö–Ω–∏–π –ø—Ä–µ–¥–µ–ª —Ä–∏—Å–∫–∞ –Ω–∞ –æ–¥–Ω—É —Å–¥–µ–ª–∫—É.
                        –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–æ–∂–µ—Ç —Å–Ω–∏–∂–∞—Ç—å —Ä–∏—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="alert alert-warning small mt-4">
                        –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 1‚Äì2% –Ω–∞ —Å–¥–µ–ª–∫—É –∏ –Ω–µ –±–æ–ª–µ–µ 5% –≤ –¥–µ–Ω—å.
                    </div>
                </div>
            </div>

            <hr class="my-4"/>

            <div class="section-title">–ß–∞—Å—Ç–æ—Ç–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏</div>

            <div class="row g-4">
                <div class="col-md-4">
                    <label class="form-label">
                        –ü–∞—É–∑–∞ –º–µ–∂–¥—É —Å–¥–µ–ª–∫–∞–º–∏ (—Å–µ–∫)
                        <span class="badge bg-info ms-1">AI</span>
                    </label>
                    <input type="number" min="0"
                           class="form-control"
                           name="cooldownSeconds"
                           value="30">
                    <div class="form-text">
                        –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –Ω–æ–≤–æ–π —Å–¥–µ–ª–∫–æ–π.
                        –ú–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω—è—Ç—å—Å—è –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Ä—ã–Ω–æ—á–Ω–æ–≥–æ —à—É–º–∞.
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="alert alert-secondary small mt-4">
                        –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –≤—Ö–æ–¥—ã –∏ —Ö–∞–æ—Ç–∏—á–Ω—É—é —Ç–æ—Ä–≥–æ–≤–ª—é.
                    </div>
                </div>
            </div>

            <hr class="my-4"/>

            <div class="section-title">–ó–∞—â–∏—Ç–∞ –æ–¥–Ω–æ–π —Å–¥–µ–ª–∫–∏</div>

            <div class="row g-4">
                <div class="col-md-4">
                    <label class="form-label">
                        Stop Loss (%)
                        <span class="badge bg-danger ms-1">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
                    </label>
                    <input type="number" step="0.1"
                           class="form-control"
                           name="stopLossPct"
                           th:value="${strategy.stopLossPct}">
                    <div class="form-text">
                        –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∑–∞—â–∏—Ç—ã.
                        –ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á—ë–Ω.
                    </div>
                </div>

                <div class="col-md-4">
                    <label class="form-label">
                        Take Profit (%)
                        <span class="badge bg-info ms-1">AI</span>
                    </label>
                    <input type="number" step="0.1"
                           class="form-control"
                           name="takeProfitPct"
                           th:value="${strategy.takeProfitPct}">
                    <div class="form-text">
                        –ë–∞–∑–æ–≤—ã–π –æ—Ä–∏–µ–Ω—Ç–∏—Ä –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –ø—Ä–∏–±—ã–ª–∏.
                        –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç—å —Å–¥–µ–ª–∫—É —Ä–∞–Ω—å—à–µ.
                    </div>
                </div>

                <div class="col-md-4">
                    <label class="form-label">
                        –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ (%)
                        <span class="badge bg-info ms-1">AI</span>
                    </label>
                    <input type="number" step="0.01"
                           class="form-control"
                           name="maxSlippagePct"
                           placeholder="0.20"
                           readonly>
                    <div class="form-text">
                        –ó–∞—â–∏—Ç–∞ –æ—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ –ø–ª–æ—Ö–æ–π —Ü–µ–Ω–µ.
                        –£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏—Å—Ç–µ–º–æ–π.
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-end mt-4">
                <button type="submit"
                        class="btn btn-primary"
                        name="saveScope"
                        value="risk">
                    ‚úî –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ¬´–†–∏—Å–∫¬ª
                </button>
            </div>
        </div>

        <!-- ====================== TRADE TAB ==================== -->
        <div class="tab-pane" id="tab-trade">

            <div class="section-title">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ç–æ—Ä–≥–æ–≤–ª–∏</div>

            <div class="row g-4">
                <div class="col-md-4">
                    <label class="form-label">
                        –¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞
                        <span class="badge bg-secondary ms-1">–†—ã–Ω–æ–∫</span>
                    </label>
                    <input id="symbolInput" class="form-control"
                           name="symbol"
                           th:value="${strategy.symbol}">
                    <div class="form-text">
                        –ü–∞—Ä–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –±–æ—Ç –±—É–¥–µ—Ç —Å–æ–≤–µ—Ä—à–∞—Ç—å —Å–¥–µ–ª–∫–∏.
                    </div>
                </div>

                <div class="col-md-4">
                    <label class="form-label">
                        –¢–∞–π–º—Ñ—Ä–µ–π–º
                        <span class="badge bg-secondary ms-1">–î–∞–Ω–Ω—ã–µ</span>
                    </label>
                    <select class="form-select" name="timeframe">
                        <option th:each="tf : ${availableTimeframes}"
                                th:text="${tf}"
                                th:selected="${strategy.timeframe == tf}"></option>
                    </select>
                    <div class="form-text">
                        –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
                    </div>
                </div>

                <div class="col-md-4">
                    <label class="form-label">
                        –°–≤–µ—á–µ–π –≤ –∏—Å—Ç–æ—Ä–∏–∏
                        <span class="badge bg-info ms-1">AI</span>
                    </label>
                    <input type="number" min="100" max="5000" step="50"
                           class="form-control"
                           name="cachedCandlesLimit"
                           th:value="${strategy.cachedCandlesLimit}">
                    <div class="form-text">
                        –°–∫–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–≤–µ—á–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.
                    </div>
                </div>
            </div>

            <hr class="my-4"/>

            <div class="section-title">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–∏—Ä–∂–∏</div>

            <div class="row g-4">
                <div class="col-md-3">
                    <label class="form-label">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ —Å–¥–µ–ª–∫–∏</label>
                    <input class="form-control" readonly
                           th:value="${symbolInfo?.minNotional != null ? symbolInfo.minNotional : '‚Äî'}">
                </div>

                <div class="col-md-3">
                    <label class="form-label">–®–∞–≥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞</label>
                    <input class="form-control" readonly
                           th:value="${symbolInfo?.stepSize != null ? symbolInfo.stepSize : '‚Äî'}">
                </div>

                <div class="col-md-3">
                    <label class="form-label">–®–∞–≥ —Ü–µ–Ω—ã</label>
                    <input class="form-control" readonly
                           th:value="${symbolInfo?.tickSize != null ? symbolInfo.tickSize : '‚Äî'}">
                </div>

                <div class="col-md-3">
                    <label class="form-label">–õ–∏–º–∏—Ç –æ—Ä–¥–µ—Ä–æ–≤</label>
                    <input class="form-control" readonly
                           th:value="${symbolInfo?.maxOrders != null ? symbolInfo.maxOrders : '‚Äî'}">
                </div>
            </div>

            <div class="alert alert-secondary small mt-3">
                –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–∞—é—Ç—Å—è –±–∏—Ä–∂–µ–π –∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω—ã.
                –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ –Ω–∏—Ö.
            </div>

            <hr class="my-4"/>

            <div class="section-title">–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫</div>

            <div class="row g-4">
                <div class="col-md-4">
                    <label class="form-label">
                        –¢–∏–ø –≤—Ö–æ–¥–∞
                        <span class="badge bg-info ms-1">AI</span>
                    </label>
                    <select class="form-control" name="entryOrderType">
                        <option value="MARKET">–ü–æ —Ä—ã–Ω–∫—É (–±—ã—Å—Ç—Ä–æ)</option>
                        <option value="LIMIT">–õ–∏–º–∏—Ç–Ω—ã–π (—Ç–æ—á–Ω–µ–µ)</option>
                    </select>
                    <div class="form-text">
                        –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–æ–∂–µ—Ç –≤—ã–±–∏—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
                    </div>
                </div>

                <div class="col-md-4">
                    <label class="form-label">
                        –£—Å–ª–æ–≤–∏–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
                        <span class="badge bg-info ms-1">AI</span>
                    </label>
                    <select class="form-control" name="timeInForce">
                        <option value="GTC">GTC ‚Äî –¥–æ –æ—Ç–º–µ–Ω—ã</option>
                        <option value="IOC">IOC ‚Äî —Å—Ä–∞–∑—É –∏–ª–∏ –æ—Ç–º–µ–Ω–∞</option>
                        <option value="FOK">FOK ‚Äî –≤—Å—ë –∏–ª–∏ –Ω–∏—á–µ–≥–æ</option>
                    </select>
                    <div class="form-text">
                        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ª–∏–º–∏—Ç–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤.
                    </div>
                </div>

                <div class="col-md-4 d-flex align-items-end">
                    <label class="form-check form-switch">
                        <input class="form-check-input" type="checkbox"
                               name="useOcoExit" checked>
                        <span class="ms-2">–ê–≤—Ç–æ–≤—ã—Ö–æ–¥ (TP + SL)</span>
                    </label>
                    <div class="form-text">
                        –ë–∏—Ä–∂–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—Å—Ç–∞–≤–∏—Ç –∑–∞—â–∏—Ç–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞.
                    </div>
                </div>
            </div>

            <hr class="my-4"/>

            <div class="section-title">–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏</div>

            <div class="row g-4">
                <div class="col-md-4">
                    <label class="form-label">
                        –ö–∞–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä
                        <span class="badge bg-secondary ms-1">–í—ã–±–æ—Ä</span>
                    </label>
                    <select class="form-control" name="orderSizingMode">
                        <option value="FIXED_USDT">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞</option>
                        <option value="PERCENT_BALANCE">–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –±–∞–ª–∞–Ω—Å–∞</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label class="form-label">–°—É–º–º–∞ —Å–¥–µ–ª–∫–∏ (USDT)</label>
                    <input type="number" step="0.01"
                           class="form-control"
                           name="orderUsd"
                           placeholder="–ù–∞–ø—Ä. 20">
                    <div class="form-text">
                        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º.
                    </div>
                </div>

                <div class="col-md-4">
                    <label class="form-label">–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –±–∞–ª–∞–Ω—Å–∞ (%)</label>
                    <input type="number" step="0.1"
                           class="form-control"
                           name="orderPct"
                           placeholder="–ù–∞–ø—Ä. 5">
                    <div class="form-text">
                        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π —Ä–µ–∂–∏–º.
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-end mt-4">
                <button type="submit"
                        class="btn btn-primary"
                        name="saveScope"
                        value="trade">
                    ‚úî –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ¬´–¢–æ—Ä–≥–æ–≤–ª—è¬ª
                </button>
            </div>
        </div>

        <!-- ====================== ADVANCED TAB ================= -->
        <div class="tab-pane" id="tab-advanced">

            <div class="section-title">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ: —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏ AI</div>

            <div class="alert alert-secondary small">
                –ó–¥–µ—Å—å –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
                –ï—Å–ª–∏ –≤—ã –Ω–µ —É–≤–µ—Ä–µ–Ω—ã ‚Äî –æ—Å—Ç–∞–≤—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
            </div>

            <div class="section-title mt-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏</div>

            <div class="row g-4">
                <div class="col-md-4">
                    <label class="form-label">–ö—Ç–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏</label>

                    <select class="form-select" name="advancedControlMode">
                        <option value="MANUAL"
                                th:selected="${strategy?.advancedControlMode?.name() == 'MANUAL'}">
                            –†—É—á–Ω–æ–π (—Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
                        </option>

                        <option value="HYBRID"
                                th:selected="${strategy?.advancedControlMode?.name() == 'HYBRID'}">
                            –ì–∏–±—Ä–∏–¥ (AI –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç)
                        </option>

                        <option value="AI"
                                th:selected="${strategy?.advancedControlMode?.name() == 'AI'}">
                            –ê–≤—Ç–æ (AI —É–ø—Ä–∞–≤–ª—è–µ—Ç)
                        </option>
                    </select>

                    <div class="form-text">
                        –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫—Ç–æ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
                    </div>
                </div>

                <div class="col-md-8">
                    <div class="alert alert-info small mt-4">
                        –í —Ä–µ–∂–∏–º–∞—Ö <b>–ì–∏–±—Ä–∏–¥</b> –∏ <b>–ê–≤—Ç–æ</b> –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–≥—É—Ç
                        –∏–∑–º–µ–Ω—è—Ç—å—Å—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –≤ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö.
                    </div>
                </div>
            </div>

            <hr class="my-4"/>

            <div class="section-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</div>

            <div class="alert alert-dark small mb-3">
                <b>–°—Ç—Ä–∞—Ç–µ–≥–∏—è:</b> <span th:text="${type}">TYPE</span><br/>
                –ù–∏–∂–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
            </div>

            <div th:if="${strategyAdvancedHtml != null}"
                 th:utext="${strategyAdvancedHtml}">
            </div>

            <div th:if="${strategyAdvancedHtml == null}"
                 class="alert alert-secondary small">
                –î–ª—è —ç—Ç–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
            </div>

            <hr class="my-4"/>

            <div class="section-title">AI –∏ –∞–≤—Ç–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è</div>

            <div class="alert alert-warning small">
                –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ–∑–∂–µ.
                –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∫–∞–∑–∞–Ω –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –±—É–¥—É—â–∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.
            </div>

            <div class="row g-4">
                <div class="col-md-4">
                    <label class="form-label">–†–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è</label>
                    <select class="form-select" disabled>
                        <option>–í—ã–∫–ª—é—á–µ–Ω–æ</option>
                        <option>–°–∏–º—É–ª—è—Ü–∏—è (paper)</option>
                        <option>Live</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label class="form-label">–ü–µ—Ä–∏–æ–¥ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è (—á–∞—Å—ã)</label>
                    <input type="number" class="form-control" disabled placeholder="–ù–∞–ø—Ä. 12">
                </div>

                <div class="col-md-4">
                    <label class="form-label">–ú–µ—Ç—Ä–∏–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</label>
                    <select class="form-select" disabled>
                        <option>PnL</option>
                        <option>Sharpe</option>
                        <option>–ü—Ä–æ—Å–∞–¥–∫–∞</option>
                    </select>
                </div>
            </div>

            <hr class="my-4"/>

            <div class="section-title">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</div>

            <div class="row g-4">
                <div class="col-md-6">
                    <label class="form-label">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ</label>
                    <input class="form-control" readonly value="‚Äî">
                </div>

                <div class="col-md-6">
                    <label class="form-label">–ò—Å—Ç–æ—á–Ω–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è</label>
                    <input class="form-control" readonly value="‚Äî">
                </div>
            </div>

            <div class="d-flex justify-content-end mt-4">
                <button type="submit"
                        class="btn btn-primary"
                        name="saveScope"
                        value="advanced">
                    ‚úî –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ¬´–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ¬ª
                </button>
            </div>
        </div>

    </form>

    <script th:src="@{/js/views/strategies/settings.js}"></script>
</div>
