<div th:fragment="content"
     class="container py-4 strategy-settings-page"
     th:attr="
        data-chat-id=${chatId},
        data-type=${type},
        data-exchange=${selectedExchange},
        data-network=${selectedNetwork}
     ">

    <link rel="stylesheet" th:href="@{/css/views/strategies/settings.css}"/>

    <h2 class="fw-bold mb-4">
        <i class="bi bi-gear-wide-connected"></i>
        –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ ‚Äî <span th:text="${type}">TYPE</span>
    </h2>

    <hr class="my-4"/>

    <!-- ====================== –¢–ê–ë–´ ====================== -->
    <ul class="nav nav-tabs mb-3">
        <li class="nav-item"><span class="nav-link tab-btn active" data-tab="tab-network">–°–µ—Ç—å</span></li>
        <li class="nav-item"><span class="nav-link tab-btn" data-tab="tab-general">–û–±—â–∏–µ</span></li>
        <li class="nav-item"><span class="nav-link tab-btn" data-tab="tab-risk">–†–∏—Å–∫</span></li>
        <li class="nav-item"><span class="nav-link tab-btn" data-tab="tab-trade">–¢–æ—Ä–≥–æ–≤–ª—è</span></li>
        <li class="nav-item"><span class="nav-link tab-btn" data-tab="tab-advanced">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ</span></li>
    </ul>

    <!-- ===================================================== -->
    <!-- TAB CONTENT (–í–ê–ñ–ù–û)                                   -->
    <!-- ===================================================== -->
    <div class="tab-content">

        <!-- ===================================================== -->
        <!-- TAB: NETWORK (–ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï –ü–†–ò –ò–ó–ú–ï–ù–ï–ù–ò–ò SELECT)     -->
        <!-- ===================================================== -->
        <div class="tab-pane active" id="tab-network">

            <div class="card card-theme p-4">

                <!-- ===================================================== -->
                <!-- 1) –ë–ò–†–ñ–ê + –°–ï–¢–¨ (auto-save) -->
                <!-- ===================================================== -->
                <div class="section-title">–ë–∏—Ä–∂–∞ –∏ —Å–µ—Ç—å</div>

                <form id="networkForm"
                      method="post"
                      th:action="@{|/strategies/${type}/config?chatId=${chatId}|}">

                    <input type="hidden" name="saveScope" value="network"/>
                    <input type="hidden" name="tab" value="network"/>

                    <div class="row g-4">

                        <!-- –ë–∏—Ä–∂–∞ -->
                        <div class="col-md-4">
                            <label class="form-label">–ë–∏—Ä–∂–∞</label>
                            <select id="exchangeSelect"
                                    class="form-control"
                                    name="exchange">
                                <option th:each="ex : ${availableExchanges}"
                                        th:value="${ex}"
                                        th:text="${ex}"
                                        th:selected="${selectedExchange == ex}">
                                </option>
                            </select>
                            <div class="form-text text-secondary">
                                –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏.
                            </div>
                        </div>

                        <!-- –°–µ—Ç—å -->
                        <div class="col-md-4">
                            <label class="form-label">–°–µ—Ç—å</label>
                            <select id="networkSelect"
                                    class="form-control"
                                    name="network">
                                <option value="MAINNET"
                                        th:selected="${selectedNetwork?.name() == 'MAINNET'}">
                                    MAINNET
                                </option>
                                <option value="TESTNET"
                                        th:selected="${selectedNetwork?.name() == 'TESTNET'}">
                                    TESTNET
                                </option>
                            </select>
                            <div class="form-text text-secondary">
                                –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏.
                            </div>
                        </div>

                        <!-- –°—Ç–∞—Ç—É—Å -->
                        <div class="col-md-4 d-flex flex-column justify-content-end">
                            <div class="fw-bold mb-1"
                                 th:classappend="${connectionOk} ? 'text-success' : 'text-danger'">
                                <span th:text="${connectionOk} ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è'"></span>
                            </div>

                            <div>
                                <span class="badge bg-success"
                                      th:if="${exchangeSettings != null and exchangeSettings.hasBaseKeys()}">
                                    –ö–ª—é—á–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
                                </span>
                                <span class="badge bg-secondary"
                                      th:if="${exchangeSettings == null or !exchangeSettings.hasBaseKeys()}">
                                    –ö–ª—é—á–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã
                                </span>
                            </div>
                        </div>

                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" -->
                    <div class="d-flex gap-2 mt-4">
                        <a th:href="@{/strategies(chatId=${chatId})}"
                           class="btn btn-outline-secondary">
                            ‚óÄ –ù–∞–∑–∞–¥
                        </a>

                        <!-- —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ-—Å–µ–π–≤–∞ -->
                        <div class="ms-auto text-secondary small" id="network-autosave-status"></div>
                    </div>

                </form>

                <!-- ===================================================== -->
                <!-- 2) –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê -->
                <!-- ===================================================== -->
                <div class="section-title mt-4">–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ API</div>

                <div id="diagnostics-box">
                    <div class="d-flex align-items-center gap-2 mb-2">
                        <button type="button"
                                id="btn-diagnose"
                                class="btn btn-outline-info btn-sm"
                                th:data-chat-id="${chatId}"
                                th:data-exchange="${selectedExchange}"
                                th:data-network="${selectedNetwork != null ? selectedNetwork.name() : 'TESTNET'}">
                            üîç –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
                        </button>

                        <span id="diag-status" class="text-secondary small">
                            –ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É¬ª.
                        </span>
                    </div>

                    <div id="diag-not-supported"
                         class="text-warning"
                         style="display:none;">
                        –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è Binance –∏ Bybit.
                    </div>

                    <!-- ‚ö†Ô∏è —É–±—Ä–∞–ª table-dark, —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª–æ —Å —Ç–µ–º–æ–π -->
                    <table id="diag-table"
                           class="table table-bordered align-middle text-center mt-2"
                           style="max-width:600px; display:none;">
                        <tbody>
                        <tr><td>API Key –≤–∞–ª–∏–¥–µ–Ω</td><td id="d-apiKeyValid">‚Äî</td></tr>
                        <tr><td>Secret –≤–∞–ª–∏–¥–µ–Ω</td><td id="d-secretValid">‚Äî</td></tr>
                        <tr><td>–ü–æ–¥–ø–∏—Å—å</td><td id="d-signatureValid">‚Äî</td></tr>
                        <tr><td>–î–æ—Å—Ç—É–ø –∫ –∞–∫–∫–∞—É–Ω—Ç—É</td><td id="d-accountReadable">‚Äî</td></tr>
                        <tr><td>–†–∞–∑—Ä–µ—à–µ–Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—è</td><td id="d-tradingAllowed">‚Äî</td></tr>
                        <tr><td>IP —Ä–∞–∑—Ä–µ—à—ë–Ω</td><td id="d-ipAllowed">‚Äî</td></tr>
                        <tr><td>–°–µ—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞</td><td id="d-networkOk">‚Äî</td></tr>
                        </tbody>
                    </table>

                    <div id="diag-message"
                         class="text-secondary mt-2"
                         style="display:none;"></div>
                </div>

                <!-- ===================================================== -->
                <!-- 3) API –ö–õ–Æ–ß–ò -->
                <!-- ===================================================== -->
                <div class="section-title mt-4">API –∫–ª—é—á–∏</div>

                <form id="keysForm"
                      method="post"
                      th:action="@{|/strategies/${type}/config?chatId=${chatId}|}">

                    <input type="hidden" name="saveScope" value="keys"/>
                    <input type="hidden" name="tab" value="network"/>

                    <!-- ‚úÖ –í–ê–ñ–ù–û: —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è JS –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ —Å–º–µ–Ω–µ –±–∏—Ä–∂–∏/—Å–µ—Ç–∏ -->
                    <input type="hidden"
                           id="keysExchange"
                           name="exchange"
                           th:value="${selectedExchange}"/>

                    <input type="hidden"
                           id="keysNetwork"
                           name="network"
                           th:value="${selectedNetwork != null ? selectedNetwork.name() : 'TESTNET'}"/>

                    <div class="row g-4">
                        <div class="col-md-4">
                            <label class="form-label">API Key</label>
                            <input class="form-control"
                                   name="apiKey"
                                   type="password"
                                   autocomplete="off"
                                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                   inputmode="text">
                            <div class="form-text text-secondary">
                                –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –º–µ–Ω—è—Ç—å.
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">API Secret</label>
                            <input class="form-control"
                                   name="apiSecret"
                                   type="password"
                                   autocomplete="off"
                                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                   inputmode="text">
                            <div class="form-text text-secondary">
                                –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –º–µ–Ω—è—Ç—å.
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Passphrase</label>
                            <input class="form-control"
                                   name="passphrase"
                                   type="password"
                                   autocomplete="off"
                                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                   inputmode="text">
                            <div class="form-text text-secondary">
                                –ù—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±–∏—Ä–∂ (–Ω–∞–ø—Ä–∏–º–µ—Ä OKX).
                            </div>
                        </div>
                    </div>

                    <div class="d-flex gap-2 mt-4">
                        <div class="ms-auto">
                            <button type="submit" class="btn btn-primary">
                                ‚úî –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ¬´–ö–ª—é—á–∏¬ª
                            </button>
                        </div>
                    </div>

                </form>

            </div>
        </div>

        <!-- ===================================================== -->
        <!-- TAB: GENERAL (–û–¢–î–ï–õ–¨–ù–ê–Ø –§–û–†–ú–ê)                         -->
        <!-- ===================================================== -->
        <div class="tab-pane" id="tab-general">

            <form method="post"
                  th:object="${strategy}"
                  th:action="@{|/strategies/${type}/config?chatId=${chatId}|}"
                  class="card card-theme p-4"
                  id="generalForm"
                  autocomplete="off"
                  novalidate>

                <!-- –æ—Å—Ç–∞–≤–∏–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–æ —Ä–µ–∞–ª—å–Ω–æ –Ω–µ —Å–∞–±–º–∏—Ç–∏–º -->
                <input type="hidden" name="saveScope" value="general"/>
                <input type="hidden" name="tab" value="general"/>

                <!-- —Ç–µ–∫—É—â–∏–π scope (–±–∏—Ä–∂–∞/—Å–µ—Ç—å) -->
                <input type="hidden" name="exchange" th:value="${selectedExchange}"/>
                <input type="hidden" name="network"
                       th:value="${selectedNetwork != null ? selectedNetwork.name() : 'TESTNET'}"/>

                <!-- ===================================================== -->
                <!-- HEADER / STATUS BAR                                   -->
                <!-- ===================================================== -->
                <div class="card card-theme p-3 mb-3"
                     th:attr="data-strategy-active=${strategy != null and strategy.active}"
                     id="generalHeader">

                    <div class="d-flex align-items-start justify-content-between gap-3 flex-wrap">
                        <div class="me-auto">
                            <div class="fw-bold d-flex align-items-center gap-2 flex-wrap">
                                <span>–û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</span>

                                <!-- badge: active -->
                                <span class="badge"
                                      th:classappend="${strategy != null and strategy.active} ? ' bg-success' : ' bg-secondary'"
                                      th:text="${strategy != null and strategy.active} ? 'üü¢ –ê–∫—Ç–∏–≤–Ω–∞' : '‚ö´ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞'">
                            ‚ö´ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
                        </span>

                                <!-- badge: exchange/network -->
                                <span class="badge bg-info text-dark"
                                      th:text="${selectedExchange + ' / ' + (selectedNetwork != null ? selectedNetwork.name() : 'TESTNET')}">
                            BINANCE / TESTNET
                        </span>

                                <!-- badge: dirty state (JS) -->
                                <span class="badge bg-warning text-dark d-none" id="generalDirtyBadge">
                            –ï—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        </span>
                            </div>

                            <div class="small text-secondary mt-2" id="generalSaveHint">
                                –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏).
                                <span class="d-block mt-1">–î–ª—è ‚Äú–æ–ø–∞—Å–Ω—ã—Ö‚Äù –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.</span>
                            </div>

                            <div class="small mt-2">
                                <span class="badge bg-secondary" id="generalSaveState">–ì–æ—Ç–æ–≤–æ</span>
                                <span class="text-secondary ms-2" id="generalSaveMeta"></span>
                            </div>
                        </div>

                        <div class="text-end">
                            <!-- –æ—Å—Ç–∞–≤–∏–º –Ω–∞ –±—É–¥—É—â–µ–µ -->
                            <button type="button"
                                    class="btn btn-outline-warning btn-sm d-none"
                                    id="generalApplyBtn">
                                ‚ö° –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤ —Ç–æ—Ä–≥–æ–≤–ª—é
                            </button>
                        </div>
                    </div>

                    <div class="small text-secondary mt-2 d-none" id="generalChangedList"></div>
                </div>

                <!-- ================== 1) –†–ï–ñ–ò–ú –£–ü–†–ê–í–õ–ï–ù–ò–Ø ================== -->
                <div class="section-title">–†–µ–∂–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π</div>

                <div class="row g-4 align-items-end">
                    <div class="col-md-4">
                        <label class="form-label" for="advancedControlMode">–ö—Ç–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏</label>

                        <select class="form-select"
                                id="advancedControlMode"
                                th:field="*{advancedControlMode}"
                                data-confirm="true"
                                data-confirm-title="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ"
                                data-confirm-text="–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–∂–µ—Ç —Å–∏–ª—å–Ω–æ –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å?">
                            <option value="MANUAL">–†—É—á–Ω–æ–π (—Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)</option>
                            <option value="HYBRID">–ì–∏–±—Ä–∏–¥ (AI –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç)</option>
                            <option value="AI">–ê–≤—Ç–æ (AI —É–ø—Ä–∞–≤–ª—è–µ—Ç)</option>
                        </select>

                        <div class="form-text">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –≤–∫–ª–∞–¥–∫–∞—Ö.</div>
                    </div>

                    <div class="col-md-8">
                        <div class="alert alert-info small mb-0" id="controlModeHint">
                            <b>MANUAL:</b> –≤—Å—ë –º–µ–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.
                            <br><b>HYBRID:</b> AI –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç/–ø—Ä–∞–≤–∏—Ç.
                            <br><b>AI:</b> AI —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî —Ç–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏ –∏ –±–∞–∑–æ–≤—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏.
                        </div>
                    </div>
                </div>

                <hr class="my-4"/>

                <!-- ================== 2) –ë–Æ–î–ñ–ï–¢ + –ê–ö–¢–ò–í/–ë–ê–õ–ê–ù–° ================== -->
                <div class="section-title">–ë—é–¥–∂–µ—Ç –∏ –∞–∫—Ç–∏–≤</div>

                <div class="row g-4">
                    <div class="col-md-4">
                        <label class="form-label" for="accountAssetSelect">–ê–∫—Ç–∏–≤ —Å—á—ë—Ç–∞</label>

                        <select class="form-select"
                                id="accountAssetSelect"
                                th:field="*{accountAsset}"
                                th:disabled="${#lists.isEmpty(availableAssets)}">
                            <option th:each="asset : ${availableAssets}"
                                    th:value="${asset}"
                                    th:text="${asset}">
                            </option>
                        </select>

                        <div class="form-text">–û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤—ã —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º.</div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label" for="availableBalanceView">–î–æ—Å—Ç—É–ø–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤</label>
                        <div class="input-group">
                            <input class="form-control" readonly
                                   id="availableBalanceView"
                                   th:value="${availableBalance != null ? availableBalance : '‚Äî'}">
                            <span class="input-group-text"
                                  id="selectedAssetView"
                                  th:text="${strategy != null && strategy.accountAsset != null ? strategy.accountAsset : '‚Äî'}">
                        USDT
                    </span>
                        </div>
                        <div class="form-text">–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å –Ω–∞ –±–∏—Ä–∂–µ (free).</div>
                    </div>

                    <div class="col-md-4">
                        <div class="alert alert-secondary small mb-0">
                            –°–æ–≤–µ—Ç: –≤—ã–±–µ—Ä–∏ –∞–∫—Ç–∏–≤ –∏ –ª–∏–º–∏—Ç –±—é–¥–∂–µ—Ç–∞ ‚Äî —Ç–∞–∫ —Ç—ã –æ–≥—Ä–∞–Ω–∏—á–∏—à—å —Ä–∏—Å–∫ ‚Äú–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Å–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞‚Äù.
                        </div>
                    </div>
                </div>

                <div class="row g-4 align-items-end mt-1">
                    <div class="col-md-4">
                        <label class="form-label" for="strategyBudgetMode">–ë—é–¥–∂–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</label>

                        <select class="form-select"
                                id="strategyBudgetMode"
                                data-confirm="true"
                                data-confirm-title="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ"
                                data-confirm-text="–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –±—é–¥–∂–µ—Ç–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ–±—ä—ë–º —Å–¥–µ–ª–æ–∫. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å?">
                            <option value="NONE">–ë–µ–∑ –ª–∏–º–∏—Ç–∞ (–≤–µ—Å—å –±–∞–ª–∞–Ω—Å)</option>
                            <option value="USD">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞</option>
                            <option value="PCT">–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –±–∞–ª–∞–Ω—Å–∞</option>
                        </select>

                        <div class="form-text">–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Å—É–º–º—É, –∫–æ—Ç–æ—Ä—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –º–æ–∂–µ—Ç –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å.</div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label" id="strategyBudgetValueLabel" for="strategyBudgetValue">–ó–Ω–∞—á–µ–Ω–∏–µ</label>

                        <input type="number"
                               class="form-control"
                               id="strategyBudgetValue"
                               step="1"
                               min="0"
                               placeholder="–ù–∞–ø—Ä. 500"
                               data-confirm="true"
                               data-confirm-title="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ"
                               data-confirm-text="–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –±—é–¥–∂–µ—Ç–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ–±—ä—ë–º —Å–¥–µ–ª–æ–∫. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å?"/>

                        <input type="text"
                               class="form-control d-none"
                               id="strategyBudgetValueReadonly"
                               readonly
                               value="–í–µ—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å"/>

                        <div class="form-text" id="strategyBudgetValueHint"></div>
                    </div>

                    <div class="col-md-4">
                        <div class="alert alert-info small mt-4" id="strategyBudgetPreview">
                            –í—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º –ª–∏–º–∏—Ç–∞.
                        </div>
                    </div>

                    <!-- backend initial mode -->
                    <input type="hidden"
                           id="strategyBudgetInitialMode"
                           th:value="${strategy != null && strategy.maxExposureUsd != null ? 'USD' : (strategy != null && strategy.maxExposurePct != null ? 'PCT' : 'NONE')}" />

                    <!-- ‚úÖ canonical values (go to DB) -->
                    <input type="hidden"
                           id="maxExposureUsd"
                           th:field="*{maxExposureUsd}"/>

                    <input type="hidden"
                           id="maxExposurePct"
                           th:field="*{maxExposurePct}"/>
                </div>

                <hr class="my-4"/>

                <!-- ================== 3) –î–ù–ï–í–ù–û–ô –õ–ò–ú–ò–¢ –ü–û–¢–ï–†–¨ ================== -->
                <div class="section-title">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —É–±—ã—Ç–∫–æ–≤</div>

                <div class="row g-4">
                    <div class="col-md-4">
                        <label class="form-label" for="dailyLossLimitPct">
                            –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –∑–∞ –¥–µ–Ω—å (%)
                            <span class="badge bg-secondary ms-1">–õ–∏–º–∏—Ç</span>
                        </label>

                        <input type="number"
                               step="0.1"
                               min="0"
                               max="100"
                               class="form-control"
                               id="dailyLossLimitPct"
                               th:field="*{dailyLossLimitPct}"
                               placeholder="–ù–∞–ø—Ä. 3.5"
                               data-confirm="true"
                               data-confirm-title="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ"
                               data-confirm-text="–ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Ä–∞–Ω—å—à–µ/–ø–æ–∑–∂–µ. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å?"/>

                        <div class="form-text">
                            –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è.
                        </div>
                    </div>

                    <div class="col-md-8">
                        <div class="alert alert-warning small mb-0">
                            –≠—Ç–æ ‚Äú–∂—ë—Å—Ç–∫–∏–π —Å—Ç–æ–ø‚Äù –ø–æ –¥–Ω—é. –ù–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ SL –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–¥–µ–ª–∫–∏.
                        </div>
                    </div>
                </div>

                <hr class="my-4"/>

                <!-- ================== 4) –ü–†–ò–ë–´–õ–¨ ================== -->
                <div class="section-title">–ü—Ä–∏–±—ã–ª—å</div>

                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="form-check">
                            <input class="form-check-input"
                                   type="checkbox"
                                   id="reinvestProfit"
                                   th:field="*{reinvestProfit}">
                            <label class="form-check-label" for="reinvestProfit">
                                –†–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–±—ã–ª—å
                            </label>
                        </div>

                        <div class="form-text">
                            –ü—Ä–∏–±—ã–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–¥–µ–ª–∫–∞—Ö.
                        </div>
                    </div>
                </div>

                <hr class="my-4"/>

                <!-- ================== 5) –ö–û–ú–ò–°–°–ò–ò (READ-ONLY) ================== -->
                <div class="section-title">–ö–æ–º–∏—Å—Å–∏–∏ –±–∏—Ä–∂–∏</div>

                <div class="row g-4 align-items-end">
                    <div class="col-md-4">
                        <label class="form-label">–ö–æ–º–∏—Å—Å–∏—è Maker</label>
                        <div class="input-group">
                            <input class="form-control" readonly
                                   th:value="${(accountFees != null and accountFees.makerPct != null)
                 ? (#numbers.formatDecimal(accountFees.makerPct, 1, 'POINT', 4, 'POINT') + ' %')
                 : '‚Äî'}">
                            <span class="input-group-text">%</span>
                        </div>
                        <div class="form-text">–ö–æ–º–∏—Å—Å–∏—è –∑–∞ –ª–∏–º–∏—Ç–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞ (maker).</div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">–ö–æ–º–∏—Å—Å–∏—è Taker</label>
                        <div class="input-group">
                            <input class="form-control" readonly
                                   th:value="${(accountFees != null and accountFees.takerPct != null)
                 ? (#numbers.formatDecimal(accountFees.takerPct, 1, 'POINT', 4, 'POINT') + ' %')
                 : '‚Äî'}">
                            <span class="input-group-text">%</span>
                        </div>
                        <div class="form-text">–ö–æ–º–∏—Å—Å–∏—è –∑–∞ —Ä—ã–Ω–æ—á–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞ (taker).</div>
                    </div>

                    <div class="col-md-4">
                        <div class="alert alert-secondary small mb-0">
                            –ö–æ–º–∏—Å—Å–∏–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è —Å –±–∏—Ä–∂–∏ –∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
                            <span class="d-block mt-1" th:if="${accountFees == null}">
                        –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö: –ø—Ä–æ–≤–µ—Ä—å API-–∫–ª—é—á–∏ –∏–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.
                    </span>
                        </div>
                    </div>
                </div>

                <!-- ‚úÖ –ö–ù–û–ü–ö–ò –£–ë–†–ê–õ–ò –ü–û–õ–ù–û–°–¢–¨–Æ -->
            </form>
        </div>

        <!-- ===================================================== -->
        <!-- CONFIRM MODAL -->
        <!-- ===================================================== -->
        <div class="modal fade" id="generalConfirmModal" tabindex="-1" aria-hidden="true" aria-labelledby="generalConfirmTitle">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content card-theme">
                    <div class="modal-header">
                        <h5 class="modal-title" id="generalConfirmTitle">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                    </div>
                    <div class="modal-body">
                        <div id="generalConfirmText">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è?</div>
                    </div>
                    <div class="modal-footer">
                        <button type="button"
                                class="btn btn-outline-secondary"
                                data-bs-dismiss="modal"
                                id="generalConfirmCancel">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                        <button type="button" class="btn btn-primary" id="generalConfirmOk">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </div>



        <!-- ===================================================== -->
        <!-- TAB: RISK                                              -->
        <!-- ===================================================== -->
        <div class="tab-pane" id="tab-risk">
            <div class="card card-theme p-4">

                <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
                    <div>
                        <div class="fw-bold">–†–∏—Å–∫ –∏ –ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª–∏</div>
                        <div class="text-secondary small" id="riskModeHelp">
                            –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –í HYBRID –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.
                        </div>
                    </div>

                    <div class="d-flex align-items-center gap-2">
                        <span class="badge bg-secondary" id="riskModeBadge">‚Äî</span>

                        <span class="badge bg-secondary" id="riskSaveState">–ì–æ—Ç–æ–≤–æ</span>
                        <span class="small text-secondary" id="riskSaveMeta"></span>
                    </div>
                </div>

                <div class="small text-secondary mb-2 d-none" id="riskDirtyBadge">
                    –ï—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </div>

                <div class="small text-secondary mb-3" id="riskChangedList"></div>

                <!-- AI suggestions (–ø–æ—Å–ª–µ –±—ç–∫—Ç–µ—Å—Ç–∞). –ï—Å–ª–∏ API –Ω–µ—Ç/404 ‚Äî –±–ª–æ–∫ —Å–∫—Ä—ã—Ç -->
                <div class="alert alert-info d-none" id="riskAiBox">
                    <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
                        <div>
                            <div class="fw-bold">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ AI (–ø–æ—Å–ª–µ –±—ç–∫—Ç–µ—Å—Ç–∞)</div>
                            <div class="small text-secondary" id="riskAiMeta">‚Äî</div>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-outline-light btn-sm" id="riskAiReloadBtn">
                                –û–±–Ω–æ–≤–∏—Ç—å
                            </button>
                            <button type="button" class="btn btn-light btn-sm" id="riskAiApplyAllBtn">
                                –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å—ë
                            </button>
                        </div>
                    </div>

                    <div class="mt-3" id="riskAiList"></div>
                </div>

                <form id="riskForm">

                    <!-- ===== 1) –û—Å–Ω–æ–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã —Ä–∏—Å–∫–∞ ===== -->
                    <div class="row g-4 mt-1">
                        <div class="col-md-4">
                            <label class="form-label" for="riskPerTradePctInput" id="riskPerTradeLabel">
                                –†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É (%)
                            </label>
                            <input type="number"
                                   class="form-control"
                                   id="riskPerTradePctInput"
                                   step="0.1"
                                   min="0"
                                   placeholder="–ù–∞–ø—Ä. 1.0"
                                   th:value="${strategy != null ? strategy.riskPerTradePct : ''}">
                            <div class="form-text" id="riskPerTradeHint">
                                –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ —Ä–∏—Å–∫ –ø–æ –æ–¥–Ω–æ–π —Å–¥–µ–ª–∫–µ.
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label" for="minRiskRewardInput">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π Risk/Reward</label>
                            <input type="number"
                                   class="form-control"
                                   id="minRiskRewardInput"
                                   step="0.1"
                                   min="0"
                                   placeholder="–ù–∞–ø—Ä. 1.5"
                                   th:value="${strategy != null ? strategy.minRiskReward : ''}">
                            <div class="form-text">–§–∏–ª—å—Ç—Ä –≤—Ö–æ–¥–æ–≤: –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å–¥–µ–ª–∫–∏ —Å –Ω–∏–∑–∫–∏–º RR.</div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label" for="leverageInput" id="leverageLabel">–ü–ª–µ—á–æ</label>
                            <input type="number"
                                   class="form-control"
                                   id="leverageInput"
                                   step="1"
                                   min="1"
                                   placeholder="1"
                                   th:value="${strategy != null ? strategy.leverage : 1}">
                            <div class="form-text" id="leverageHint">
                                –î–ª—è —Å–ø–æ—Ç–∞ –æ–±—ã—á–Ω–æ 1. –í AI/HYBRID ‚Äî –≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞.
                            </div>
                        </div>
                    </div>

                    <!-- ===== 2) –ü–æ–ª–∏—Ç–∏–∫–∏ / –∞–Ω—Ç–∏-tilt ===== -->
                    <div class="row g-4 mt-1">
                        <div class="col-md-4">
                            <label class="form-label">–£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input"
                                       type="checkbox"
                                       id="allowAveragingInput"
                                       th:checked="${strategy != null && strategy.allowAveraging != null ? strategy.allowAveraging : false}">
                                <label class="form-check-label" for="allowAveragingInput">
                                    –†–∞–∑—Ä–µ—à–∏—Ç—å —É—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ
                                </label>
                            </div>
                            <div class="form-text">–û–ø–∞—Å–Ω–æ –±–µ–∑ —Å—Ç—Ä–æ–≥–∏—Ö –ª–∏–º–∏—Ç–æ–≤ –ø–æ–∑–∏—Ü–∏–∏/–ø—Ä–æ—Å–∞–¥–∫–∏.</div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label" for="cooldownSecondsInput">Cooldown –º–µ–∂–¥—É —Å–¥–µ–ª–∫–∞–º–∏ (—Å–µ–∫)</label>
                            <input type="number"
                                   class="form-control"
                                   id="cooldownSecondsInput"
                                   step="1"
                                   min="0"
                                   placeholder="–ù–∞–ø—Ä. 30"
                                   th:value="${strategy != null ? strategy.cooldownSeconds : ''}">
                            <div class="form-text">–ü–∞—É–∑–∞ –ø–æ—Å–ª–µ —Å–¥–µ–ª–∫–∏, —á—Ç–æ–±—ã –Ω–µ ‚Äú—Å–ø–∞–º–∏—Ç—å‚Äù.</div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label" for="maxTradesPerDayInput">–ú–∞–∫—Å. —Å–¥–µ–ª–æ–∫ –≤ –¥–µ–Ω—å</label>
                            <input type="number"
                                   class="form-control"
                                   id="maxTradesPerDayInput"
                                   step="1"
                                   min="0"
                                   placeholder="–ù–∞–ø—Ä. 20"
                                   th:value="${strategy != null ? strategy.maxTradesPerDay : ''}">
                            <div class="form-text">–õ–∏–º–∏—Ç —á–∞—Å—Ç–æ—Ç—ã —Å–¥–µ–ª–æ–∫.</div>
                        </div>
                    </div>

                    <!-- ===== 3) –ü—Ä–æ—Å–∞–¥–∫–∞ (pct/usd) ===== -->
                    <div class="row g-4 mt-1">
                        <div class="col-md-4">
                            <label class="form-label" for="maxDrawdownPctInput">–ú–∞–∫—Å. –ø—Ä–æ—Å–∞–¥–∫–∞ (%)</label>
                            <input type="number"
                                   class="form-control"
                                   id="maxDrawdownPctInput"
                                   step="0.1"
                                   min="0"
                                   placeholder="–ù–∞–ø—Ä. 10"
                                   th:value="${strategy != null ? strategy.maxDrawdownPct : ''}">
                            <div class="form-text" id="maxDrawdownPctHint">–ï—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ ‚Äî –ø–æ–ª–µ ‚Äú–≤–∞–ª—é—Ç–∞‚Äù –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω–æ.</div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label" for="maxDrawdownUsdInput">–ú–∞–∫—Å. –ø—Ä–æ—Å–∞–¥–∫–∞ (–≤ –≤–∞–ª—é—Ç–µ –∞–∫—Ç–∏–≤–∞)</label>
                            <input type="number"
                                   class="form-control"
                                   id="maxDrawdownUsdInput"
                                   step="0.000001"
                                   min="0"
                                   placeholder="–ù–∞–ø—Ä. 100"
                                   th:value="${strategy != null ? strategy.maxDrawdownUsd : ''}">
                            <div class="form-text" id="maxDrawdownUsdHint">–ï—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ ‚Äî –ø–æ–ª–µ ‚Äú%‚Äù –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω–æ.</div>
                        </div>

                        <div class="col-md-4">
                            <div class="alert alert-info small mt-4" id="drawdownPreview">
                                –ü—Ä–æ—Å–∞–¥–∫–∞: ‚Äî
                            </div>
                        </div>
                    </div>

                    <!-- ===== 4) –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ (pct/usd) ===== -->
                    <div class="row g-4 mt-1">
                        <div class="col-md-4">
                            <label class="form-label" for="maxPositionPctInput">–ú–∞–∫—Å. –ø–æ–∑–∏—Ü–∏—è (%)</label>
                            <input type="number"
                                   class="form-control"
                                   id="maxPositionPctInput"
                                   step="0.1"
                                   min="0"
                                   placeholder="–ù–∞–ø—Ä. 25"
                                   th:value="${strategy != null ? strategy.maxPositionPct : ''}">
                            <div class="form-text">–ï—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ ‚Äî –ø–æ–ª–µ ‚Äú–≤–∞–ª—é—Ç–∞‚Äù –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω–æ.</div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label" for="maxPositionUsdInput">–ú–∞–∫—Å. –ø–æ–∑–∏—Ü–∏—è (–≤ –≤–∞–ª—é—Ç–µ –∞–∫—Ç–∏–≤–∞)</label>
                            <input type="number"
                                   class="form-control"
                                   id="maxPositionUsdInput"
                                   step="0.000001"
                                   min="0"
                                   placeholder="–ù–∞–ø—Ä. 500"
                                   th:value="${strategy != null ? strategy.maxPositionUsd : ''}">
                            <div class="form-text">–ï—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ ‚Äî –ø–æ–ª–µ ‚Äú%‚Äù –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω–æ.</div>
                        </div>

                        <div class="col-md-4">
                            <div class="alert alert-info small mt-4" id="positionPreview">
                                –ü–æ–∑–∏—Ü–∏—è: ‚Äî
                            </div>
                        </div>
                    </div>

                    <!-- ===== 5) –ü–æ—Å–ª–µ —É–±—ã—Ç–∫–æ–≤ ===== -->
                    <div class="row g-4 mt-1">
                        <div class="col-md-4">
                            <label class="form-label" for="cooldownAfterLossSecondsInput">Cooldown –ø–æ—Å–ª–µ —É–±—ã—Ç–∫–∞ (—Å–µ–∫)</label>
                            <input type="number"
                                   class="form-control"
                                   id="cooldownAfterLossSecondsInput"
                                   step="1"
                                   min="0"
                                   placeholder="–ù–∞–ø—Ä. 120"
                                   th:value="${strategy != null ? strategy.cooldownAfterLossSeconds : ''}">
                        </div>

                        <div class="col-md-4">
                            <label class="form-label" for="maxConsecutiveLossesInput">–ú–∞–∫—Å. –ø–æ–¥—Ä—è–¥ —É–±—ã—Ç–æ—á–Ω—ã—Ö</label>
                            <input type="number"
                                   class="form-control"
                                   id="maxConsecutiveLossesInput"
                                   step="1"
                                   min="0"
                                   placeholder="–ù–∞–ø—Ä. 3"
                                   th:value="${strategy != null ? strategy.maxConsecutiveLosses : ''}">
                        </div>

                        <div class="col-md-4">
                            <label class="form-label" for="maxOpenOrdersInput">–ú–∞–∫—Å. –æ—Ç–∫—Ä—ã—Ç—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤</label>
                            <input type="number"
                                   class="form-control"
                                   id="maxOpenOrdersInput"
                                   step="1"
                                   min="0"
                                   placeholder="–ù–∞–ø—Ä. 5"
                                   th:value="${strategy != null ? strategy.maxOpenOrders : ''}">
                        </div>
                    </div>

                </form>
            </div>
        </div>




        <!-- ===================================================== -->
        <!-- TAB: TRADE                                             -->
        <!-- ===================================================== -->
        <div class="tab-pane" id="tab-trade">
            <div class="card card-theme p-4">

                <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
                    <div>
                        <div class="fw-bold">–¢–æ—Ä–≥–æ–≤–ª—è</div>
                        <div class="text-secondary small" id="tradeModeHint">
                            –ù–∞—Å—Ç—Ä–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —Ç–∞–π–º—Ñ—Ä–µ–π–º –∏ –¥–∞–Ω–Ω—ã–µ. –í—Å—ë —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
                        </div>
                    </div>

                    <div class="d-flex align-items-center gap-2">
                        <span class="badge bg-secondary" id="tradeModeBadge">MODE</span>
                        <span class="badge bg-secondary" id="tradeSaveState">–ì–æ—Ç–æ–≤–æ</span>
                        <span class="small text-secondary" id="tradeSaveMeta"></span>
                    </div>
                </div>

                <div class="small text-secondary mb-2 d-none" id="tradeDirtyBadge">
                    –ï—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </div>
                <div class="small text-secondary mb-3" id="tradeChangedList"></div>

                <form id="tradeForm" onsubmit="return false;">

                    <!-- ================== INSTRUMENT ================== -->
                    <div class="section-title">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ç–æ—Ä–≥–æ–≤–ª–∏</div>

                    <div class="row g-4">
                        <div class="col-md-4">

                            <label class="form-label">
                                –¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞
                                <span class="badge bg-secondary ms-1">–†—ã–Ω–æ–∫</span>
                            </label>

                            <!-- MODE SWITCH -->
                            <div class="btn-group btn-group-sm mb-2 w-100" role="group" id="tradeSymbolModes">
                                <button type="button" class="btn btn-outline-secondary active" data-symbol-mode="POPULAR">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</button>
                                <button type="button" class="btn btn-outline-secondary" data-symbol-mode="GAINERS">–†–∞—Å—Ç—É—â–∏–µ</button>
                                <button type="button" class="btn btn-outline-secondary" data-symbol-mode="LOSERS">–ü–∞–¥–∞—é—â–∏–µ</button>
                            </div>

                            <!-- SYMBOL PICKER -->
                            <div class="dropdown">
                                <div id="symbolDropdown"
                                     class="form-control strategy-input dropdown-toggle text-start"
                                     data-bs-toggle="dropdown"
                                     aria-expanded="false"
                                     role="button"
                                     tabindex="0">
                            <span id="symbolLabel"
                                  th:text="${strategy.symbol != null ? strategy.symbol : '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—É—é –ø–∞—Ä—É'}">
                            </span>
                                </div>

                                <ul class="dropdown-menu w-100 strategy-dropdown" id="symbolList">
                                    <!-- –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                                </ul>
                            </div>

                            <input type="hidden" id="symbolHidden" th:value="${strategy.symbol}">

                            <div class="form-text">
                                –ü–∞—Ä–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –±–æ—Ç –±—É–¥–µ—Ç —Å–æ–≤–µ—Ä—à–∞—Ç—å —Å–¥–µ–ª–∫–∏.
                            </div>
                        </div>
                    </div>

                    <hr class="my-4"/>

                    <!-- ================== TIMEFRAME ================== -->
                    <div class="section-title">–¢–∞–π–º—Ñ—Ä–µ–π–º</div>

                    <div class="row g-4">
                        <div class="col-md-4">

                            <label class="form-label" id="tradeTimeframeLabel">–¢–∞–π–º—Ñ—Ä–µ–π–º —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</label>

                            <!-- ‚úÖ readonly –¥–ª—è AI -->
                            <div class="form-control d-none"
                                 id="tradeTimeframeReadonly"
                                 style="cursor:not-allowed; opacity:.85;">
                                ‚Äî
                            </div>

                            <!-- ‚úÖ select –¥–ª—è MANUAL/HYBRID -->
                            <select class="form-select" id="tradeTimeframeSelect">
                                <option th:each="tf : ${availableTimeframes}"
                                        th:value="${tf}"
                                        th:text="${tf}"
                                        th:selected="${tf == strategy.timeframe}">
                                </option>
                            </select>

                            <div class="form-text" id="tradeTimeframeHint">
                                –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–π–º—Ñ—Ä–µ–π–º.
                            </div>
                        </div>

                        <div class="col-md-8">
                            <div class="alert alert-info small mt-4 d-none" id="tradeAiTimeframeNote">
                                –í —Ä–µ–∂–∏–º–µ AI —Ç–∞–π–º—Ñ—Ä–µ–π–º –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –≤ —Ä–∞–Ω—Ç–∞–π–º–µ. –í –±–∞–∑–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ fallback.
                            </div>
                        </div>
                    </div>

                    <hr class="my-4"/>

                    <!-- ================== HISTORY / DATA ================== -->
                    <div class="section-title">–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</div>

                    <div class="row g-4">
                        <div class="col-md-4">
                            <label class="form-label">
                                –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π
                                <span class="badge bg-secondary ms-1">–î–∞–Ω–Ω—ã–µ</span>
                            </label>

                            <input type="number"
                                   class="form-control"
                                   id="tradeCachedCandlesLimit"
                                   min="50"
                                   step="50"
                                   th:value="${strategy.cachedCandlesLimit}"
                                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 500">

                            <div class="form-text">
                                –°–∫–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–≤–µ—á–µ–π –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
                            </div>
                        </div>
                    </div>

                    <hr class="my-4"/>

                    <!-- ================== EXCHANGE LIMITS ================== -->
                    <div class="section-title d-flex align-items-center justify-content-between">
                        <span>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–∏—Ä–∂–∏</span>
                        <span class="badge bg-secondary">–ë–∏—Ä–∂–∞</span>
                    </div>

                    <div class="row g-4">

                        <div class="col-md-3">
                            <label class="form-label d-flex align-items-center gap-2">
                                <i class="bi bi-cash-coin"></i>
                                <span>–ú–∏–Ω. —Å—É–º–º–∞</span>
                            </label>

                            <input id="exMinNotional" class="form-control" readonly value="‚Äî">

                            <div class="d-flex align-items-center gap-2 mt-1">
                                <span id="exMinNotionalScope" class="badge bg-secondary">‚Äî</span>
                                <small class="text-muted">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ —Å–¥–µ–ª–∫–∏</small>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <label class="form-label d-flex align-items-center gap-2">
                                <i class="bi bi-bounding-box"></i>
                                <span>–®–∞–≥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞</span>
                            </label>

                            <input id="exStepSize" class="form-control" readonly value="‚Äî">

                            <div class="d-flex align-items-center gap-2 mt-1">
                                <span id="exStepSizeScope" class="badge bg-secondary">‚Äî</span>
                                <small class="text-muted">–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞</small>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <label class="form-label d-flex align-items-center gap-2">
                                <i class="bi bi-tag"></i>
                                <span>–®–∞–≥ —Ü–µ–Ω—ã</span>
                            </label>

                            <input id="exTickSize" class="form-control" readonly value="‚Äî">

                            <div class="d-flex align-items-center gap-2 mt-1">
                                <span id="exTickSizeScope" class="badge bg-secondary">‚Äî</span>
                                <small class="text-muted">–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã</small>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <label class="form-label d-flex align-items-center gap-2">
                                <i class="bi bi-stack"></i>
                                <span>–õ–∏–º–∏—Ç –æ—Ä–¥–µ—Ä–æ–≤</span>
                            </label>

                            <input id="exMaxOrders" class="form-control" readonly value="‚Äî">

                            <div class="d-flex align-items-center gap-2 mt-1">
                                <span id="exMaxOrdersScope" class="badge bg-secondary">‚Äî</span>
                                <small class="text-muted">–ê–∫—Ç–∏–≤–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞</small>
                            </div>
                        </div>

                    </div>

                    <div class="alert alert-secondary small mt-3 d-flex gap-2 align-items-start">
                        <i class="bi bi-info-circle mt-1"></i>
                        <div>
                            –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–∞—é—Ç—Å—è –±–∏—Ä–∂–µ–π –∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω—ã.
                            –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ü–µ–Ω—É/–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥ —à–∞–≥–∏ –∏ –ª–∏–º–∏—Ç—ã.
                        </div>
                    </div>

                </form>
            </div>
        </div>


        <!-- ===================================================== -->
        <!-- TAB: ADVANCED -->
        <!-- ===================================================== -->
        <div class="tab-pane fade" id="tab-advanced" role="tabpanel">
            <div class="card card-theme p-4">

                <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
                    <div>
                        <div class="fw-bold">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ</div>
                        <div class="text-secondary small">
                            –°—Ç–∞—Ç—É—Å, –º–µ—Ç—Ä–∏–∫–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (MANUAL/HYBRID/AI).
                        </div>
                    </div>

                    <div class="d-flex align-items-center gap-2">
                        <span class="badge bg-secondary" id="advModeBadge">‚Äî</span>
                        <span class="badge bg-secondary" id="advActiveBadge">‚Äî</span>
                        <span class="badge bg-secondary" id="advLoadState">–ì–æ—Ç–æ–≤–æ</span>
                    </div>
                </div>

                <!-- === METRICS === -->
                <div class="row g-4">
                    <div class="col-md-4">
                        <label class="form-label">ML confidence</label>
                        <input id="advMlConfidence" class="form-control" readonly value="‚Äî">
                        <div class="form-text">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ (read-only).</div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">Total profit (%)</label>
                        <input id="advTotalProfitPct" class="form-control" readonly value="‚Äî">
                        <div class="form-text">–°—É–º–º–∞—Ä–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (read-only).</div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</label>
                        <input id="advUpdatedAt" class="form-control" readonly value="‚Äî">
                        <div class="form-text">–ö–æ–≥–¥–∞ –∑–∞–ø–∏—Å—å –æ–±–Ω–æ–≤–ª—è–ª–∞—Å—å –≤ –±–∞–∑–µ.</div>
                    </div>
                </div>

                <hr class="my-4"/>

                <!-- === STATUS / CONTEXT === -->
                <div class="row g-4">
                    <div class="col-md-4">
                        <label class="form-label">–ó–∞–ø—É—â–µ–Ω–∞ —Å</label>
                        <input id="advStartedAt" class="form-control" readonly value="‚Äî">
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤</label>
                        <input id="advStoppedAt" class="form-control" readonly value="‚Äî">
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">–ö–æ–Ω—Ç–µ–∫—Å—Ç (asset / symbol / tf)</label>
                        <input id="advContext" class="form-control" readonly value="‚Äî">
                        <div class="form-text">–ß—Ç–æ–±—ã —Å—Ä–∞–∑—É –≤–∏–¥–µ—Ç—å, —á—Ç–æ –æ—Ç–∫—Ä—ã—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å.</div>
                    </div>
                </div>

                <hr class="my-4"/>

                <!-- === STRATEGY-SPECIFIC ADVANCED BLOCK === -->
                <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                    <div>
                        <div class="fw-bold">–ü–æ–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</div>
                        <div class="text-secondary small" id="advStrategyHint">
                            –†–µ–∂–∏–º AI –∑–∞–ø—Ä–µ—â–∞–µ—Ç —Ä—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
                        </div>
                    </div>

                    <button type="button" class="btn btn-primary btn-sm" id="advSaveBtn" disabled>
                        <i class="bi bi-save me-1"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>

                <form id="advStrategyForm" class="mt-3">
                    <div id="advStrategyBlock">
                        <div class="text-secondary small">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
                    </div>
                </form>

                <div class="alert alert-info mt-3 mb-0 d-none" id="advReadonlyNote">
                    –†–µ–∂–∏–º AI: —Ä—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ.
                </div>

            </div>
        </div>




    </div> <!-- /tab-content -->

</div>
