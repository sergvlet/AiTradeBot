<div th:fragment="content"
     class="container py-4 strategy-settings-page"
     th:attr="
        data-chat-id=${chatId},
        data-type=${type},
        data-exchange=${selectedExchange},
        data-network=${selectedNetwork}
     ">

    <link rel="stylesheet" th:href="@{/css/views/strategies/settings.css}"/>

    <h2 class="fw-bold mb-4">
        <i class="bi bi-gear-wide-connected"></i>
        –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ ‚Äî <span th:text="${type}">TYPE</span>
    </h2>

    <hr class="my-4"/>

    <!-- ====================== –¢–ê–ë–´ ====================== -->
    <ul class="nav nav-tabs mb-3">
        <li class="nav-item"><span class="nav-link tab-btn active" data-tab="tab-network">–°–µ—Ç—å</span></li>
        <li class="nav-item"><span class="nav-link tab-btn" data-tab="tab-general">–û–±—â–∏–µ</span></li>
        <li class="nav-item"><span class="nav-link tab-btn" data-tab="tab-risk">–†–∏—Å–∫</span></li>
        <li class="nav-item"><span class="nav-link tab-btn" data-tab="tab-trade">–¢–æ—Ä–≥–æ–≤–ª—è</span></li>
        <li class="nav-item"><span class="nav-link tab-btn" data-tab="tab-advanced">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ</span></li>
    </ul>

    <!-- ===================================================== -->
    <!-- TAB CONTENT (–í–ê–ñ–ù–û)                                   -->
    <!-- ===================================================== -->
    <div class="tab-content">

        <!-- ===================================================== -->
        <!-- TAB: NETWORK  (–í–ê–ñ–ù–û: –û–¢–î–ï–õ–¨–ù–´–ï –§–û–†–ú–´, –ù–ï –í–õ–û–ñ–ï–ù–ù–´–ï)   -->
        <!-- ===================================================== -->
        <div class="tab-pane active" id="tab-network">

            <div class="card card-theme p-4">

                <!-- ===================================================== -->
                <!-- 1) –ë–ò–†–ñ–ê + –°–ï–¢–¨ -->
                <!-- ===================================================== -->
                <div class="section-title">–ë–∏—Ä–∂–∞ –∏ —Å–µ—Ç—å</div>

                <form method="post"
                      th:action="@{|/strategies/${type}/config?chatId=${chatId}|}">

                    <input type="hidden" name="saveScope" value="network"/>
                    <input type="hidden" name="tab" value="network"/>

                    <div class="row g-4">

                        <!-- –ë–∏—Ä–∂–∞ -->
                        <div class="col-md-4">
                            <label class="form-label">–ë–∏—Ä–∂–∞</label>
                            <select id="exchangeSelect"
                                    class="form-control"
                                    name="exchange">
                                <option th:each="ex : ${availableExchanges}"
                                        th:value="${ex}"
                                        th:text="${ex}"
                                        th:selected="${selectedExchange == ex}">
                                </option>
                            </select>
                        </div>

                        <!-- –°–µ—Ç—å -->
                        <div class="col-md-4">
                            <label class="form-label">–°–µ—Ç—å</label>
                            <select id="networkSelect"
                                    class="form-control"
                                    name="network">
                                <option value="MAINNET"
                                        th:selected="${selectedNetwork?.name() == 'MAINNET'}">
                                    MAINNET
                                </option>
                                <option value="TESTNET"
                                        th:selected="${selectedNetwork?.name() == 'TESTNET'}">
                                    TESTNET
                                </option>
                            </select>
                        </div>

                        <!-- –°—Ç–∞—Ç—É—Å -->
                        <div class="col-md-4 d-flex flex-column justify-content-end">
                            <div class="fw-bold mb-1"
                                 th:classappend="${connectionOk} ? 'text-success' : 'text-danger'">
                                <span th:text="${connectionOk} ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ' : '–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è'"></span>
                            </div>

                            <div>
                            <span class="badge bg-success"
                                  th:if="${exchangeSettings != null and exchangeSettings.hasKeys()}">
                                –ö–ª—é—á–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
                            </span>
                                <span class="badge bg-secondary"
                                      th:if="${exchangeSettings == null or !exchangeSettings.hasKeys()}">
                                –ö–ª—é—á–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã
                            </span>
                            </div>
                        </div>

                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∏ -->
                    <div class="d-flex gap-2 mt-4">
                        <a th:href="@{/strategies(chatId=${chatId})}"
                           class="btn btn-outline-secondary">
                            ‚óÄ –ù–∞–∑–∞–¥
                        </a>

                        <div class="ms-auto">
                            <button type="submit"
                                    class="btn btn-primary">
                                ‚úî –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ¬´–°–µ—Ç—å¬ª
                            </button>
                        </div>
                    </div>

                </form>

                <!-- ===================================================== -->
                <!-- 2) –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê (AJAX, –ë–ï–ó save) -->
                <!-- ===================================================== -->
                <div class="section-title mt-4">–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ API</div>

                <div id="diagnostics-box">

                    <div class="d-flex align-items-center gap-2 mb-2">
                        <button type="button"
                                id="btn-diagnose"
                                class="btn btn-outline-info btn-sm"
                                th:data-chat-id="${chatId}"
                                th:data-exchange="${selectedExchange}"
                                th:data-network="${selectedNetwork}">
                            üîç –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
                        </button>

                        <span id="diag-status" class="text-secondary small">
                        –ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É¬ª.
                    </span>
                    </div>

                    <div id="diag-not-supported"
                         class="text-warning"
                         style="display:none;">
                        –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è Binance –∏ Bybit.
                    </div>

                    <table id="diag-table"
                           class="table table-dark table-bordered align-middle text-center mt-2"
                           style="max-width:600px; display:none;">
                        <tbody>
                        <tr><td>API Key –≤–∞–ª–∏–¥–µ–Ω</td><td id="d-apiKeyValid">‚Äî</td></tr>
                        <tr><td>Secret –≤–∞–ª–∏–¥–µ–Ω</td><td id="d-secretValid">‚Äî</td></tr>
                        <tr><td>–ü–æ–¥–ø–∏—Å—å</td><td id="d-signatureValid">‚Äî</td></tr>
                        <tr><td>–î–æ—Å—Ç—É–ø –∫ –∞–∫–∫–∞—É–Ω—Ç—É</td><td id="d-accountReadable">‚Äî</td></tr>
                        <tr><td>–†–∞–∑—Ä–µ—à–µ–Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—è</td><td id="d-tradingAllowed">‚Äî</td></tr>
                        <tr><td>IP —Ä–∞–∑—Ä–µ—à—ë–Ω</td><td id="d-ipAllowed">‚Äî</td></tr>
                        <tr><td>–°–µ—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞</td><td id="d-networkOk">‚Äî</td></tr>
                        </tbody>
                    </table>

                    <div id="diag-message"
                         class="text-secondary mt-2"
                         style="display:none;"></div>

                </div>

                <!-- ===================================================== -->
                <!-- 3) API –ö–õ–Æ–ß–ò -->
                <!-- ===================================================== -->
                <div class="section-title mt-4">API –∫–ª—é—á–∏</div>

                <form method="post"
                      th:action="@{|/strategies/${type}/config?chatId=${chatId}|}">

                    <input type="hidden" name="saveScope" value="keys"/>
                    <input type="hidden" name="tab" value="network"/>

                    <input type="hidden" name="exchange" th:value="${selectedExchange}"/>
                    <input type="hidden" name="network" th:value="${selectedNetwork?.name()}"/>

                    <div class="row g-4">

                        <div class="col-md-4">
                            <label class="form-label">API Key</label>
                            <input class="form-control"
                                   name="apiKey"
                                   type="password"
                                   autocomplete="off"
                                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            <div class="form-text text-secondary">
                                –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –º–µ–Ω—è—Ç—å.
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">API Secret</label>
                            <input class="form-control"
                                   name="apiSecret"
                                   type="password"
                                   autocomplete="off"
                                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            <div class="form-text text-secondary">
                                –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –º–µ–Ω—è—Ç—å.
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label">Passphrase</label>
                            <input class="form-control"
                                   name="passphrase"
                                   type="password"
                                   autocomplete="off"
                                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            <div class="form-text text-secondary">
                                –ù—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±–∏—Ä–∂ (–Ω–∞–ø—Ä–∏–º–µ—Ä OKX).
                            </div>
                        </div>

                    </div>

                    <div class="d-flex gap-2 mt-4">
                        <div class="ms-auto">
                            <button type="submit"
                                    class="btn btn-primary">
                                ‚úî –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ¬´–ö–ª—é—á–∏¬ª
                            </button>
                        </div>
                    </div>

                </form>

            </div>
        </div>



        <!-- ===================================================== -->
        <!-- –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô FORM –î–õ–Ø: GENERAL / RISK / TRADE / ADV   -->
        <!-- ===================================================== -->
        <form method="post"
              th:object="${strategy}"
              th:action="@{|/strategies/${type}/config?chatId=${chatId}|}"
              class="card card-theme p-4">

            <input type="hidden" name="exchange" th:value="${selectedExchange}"/>
            <input type="hidden" name="network" th:value="${selectedNetwork}"/>

            <!-- ====================== GENERAL TAB ================== -->
            <div class="tab-pane" id="tab-general">

                <div class="section-title">–ë–∞–ª–∞–Ω—Å –∞–∫–∫–∞—É–Ω—Ç–∞</div>

                <div class="row g-4">

                    <!-- üí∞ –î–û–°–¢–£–ü–ù–û –°–†–ï–î–°–¢–í -->
                    <div class="col-md-4">
                        <label class="form-label">–î–æ—Å—Ç—É–ø–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤</label>
                        <div class="input-group">
                            <input class="form-control" readonly
                                   th:value="${availableBalance != null ? availableBalance : '‚Äî'}">
                            <span class="input-group-text"
                                  th:text="${selectedAsset != null ? selectedAsset : '‚Äî'}">
                    USDT
                </span>
                        </div>
                        <div class="form-text">
                            –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å –Ω–∞ –±–∏—Ä–∂–µ (free).
                        </div>
                    </div>

                    <!-- üí± –í–´–ë–û–† –ê–ö–¢–ò–í–ê (AJAX + FORM SAFE) -->
                    <div class="col-md-4">
                        <label class="form-label">–ê–∫—Ç–∏–≤ —Å—á—ë—Ç–∞</label>

                        <!-- ‚úÖ –ï–î–ò–ù–°–¢–í–ï–ù–ù–û–ï –ø–æ–ª–µ, —É—Ö–æ–¥—è—â–µ–µ –≤ submit -->
                        <input type="hidden"
                               id="accountAssetHidden"
                               name="accountAsset"
                               th:value="${selectedAsset}" />

                        <!-- ‚ùó select –ë–ï–ó name -->
                        <select id="accountAssetSelect"
                                class="form-select"
                                th:disabled="${#lists.isEmpty(availableAssets)}"
                                th:data-chat-id="${chatId}"
                                th:data-type="${type}"
                                th:data-exchange="${selectedExchange}"
                                th:data-network="${selectedNetwork}">

                            <option th:each="asset : ${availableAssets}"
                                    th:value="${asset}"
                                    th:text="${asset}"
                                    th:selected="${asset == selectedAsset}">
                            </option>
                        </select>

                        <div class="form-text">
                            –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤—ã —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º.
                        </div>
                    </div>
                </div>

                <hr class="my-4"/>

                <div class="section-title">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤</div>

                <div class="row g-4 align-items-end">

                    <!-- MODE -->
                    <div class="col-md-4">
                        <label class="form-label">–õ–∏–º–∏—Ç</label>

                        <select class="form-select"
                                id="exposureMode">
                            <option value="NONE">–ë–µ–∑ –ª–∏–º–∏—Ç–∞ (–≤–µ—Å—å –±–∞–ª–∞–Ω—Å)</option>
                            <option value="USD">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞</option>
                            <option value="PCT">–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –±–∞–ª–∞–Ω—Å–∞</option>
                        </select>

                        <div class="form-text">
                            –í—ã–±–µ—Ä–∏, –∫–∞–∫ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤.
                        </div>
                    </div>

                    <!-- VALUE -->
                    <div class="col-md-4">
                        <label class="form-label" id="exposureValueLabel">–ó–Ω–∞—á–µ–Ω–∏–µ</label>

                        <!-- üî¢ –¥–ª—è USD / PCT -->
                        <input type="number"
                               class="form-control"
                               id="exposureValue"
                               step="1"
                               min="0"
                               placeholder="–ù–∞–ø—Ä. 500"/>

                        <!-- üîí –¥–ª—è NONE -->
                        <input type="text"
                               class="form-control d-none"
                               id="exposureValueReadonly"
                               readonly
                               value="–í–µ—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å"/>

                        <div class="form-text" id="exposureValueHint"></div>
                    </div>

                    <!-- PREVIEW -->
                    <div class="col-md-4">
                        <div class="alert alert-info small mt-4" id="exposurePreview">
                            –í—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º –ª–∏–º–∏—Ç–∞.
                        </div>
                    </div>

                    <!-- üî• –ò–°–¢–û–ß–ù–ò–ö –ò–°–¢–ò–ù–´ –ò–ó BACKEND -->
                    <input type="hidden"
                           id="exposureInitialMode"
                           th:value="${strategy.maxExposureUsd != null
                ? 'USD'
                : (strategy.maxExposurePct != null ? 'PCT' : 'NONE')}" />

                    <!-- ‚úÖ –¢–û, –ß–¢–û –£–•–û–î–ò–¢ –í –ë–î -->
                    <input type="hidden"
                           id="maxExposureUsdHidden"
                           name="maxExposureUsd"
                           th:value="${strategy.maxExposureUsd}">

                    <input type="hidden"
                           id="maxExposurePctHidden"
                           name="maxExposurePct"
                           th:value="${strategy.maxExposurePct}">
                </div>



                <script>
                    (function () {

                        const mode      = document.getElementById('exposureMode');

                        const valueNum  = document.getElementById('exposureValue');
                        const valueRO   = document.getElementById('exposureValueReadonly');

                        const label     = document.getElementById('exposureValueLabel');
                        const hint      = document.getElementById('exposureValueHint');
                        const preview   = document.getElementById('exposurePreview');

                        const usdHidden = document.getElementById('maxExposureUsdHidden');
                        const pctHidden = document.getElementById('maxExposurePctHidden');

                        const asset =
                            document.getElementById('accountAssetHidden')?.value || 'USDT';

                        const initialMode =
                            document.getElementById('exposureInitialMode')?.value || 'NONE';

                        mode.value = initialMode;

                        // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
                        if (initialMode === 'USD') {
                            valueNum.value = usdHidden.value || '';
                        } else if (initialMode === 'PCT') {
                            valueNum.value = pctHidden.value || '';
                        }

                        applyUi();

                        function applyUi() {
                            const m = mode.value;

                            // ===== NONE =====
                            if (m === 'NONE') {
                                valueNum.classList.add('d-none');
                                valueRO.classList.remove('d-none');

                                label.textContent = '–ó–Ω–∞—á–µ–Ω–∏–µ';
                                hint.textContent = '–ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤–µ—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å.';
                                preview.textContent = '–õ–∏–º–∏—Ç: –≤–µ—Å—å –±–∞–ª–∞–Ω—Å';

                                // üî• –ö–ê–ù–û–ù–ò–ß–ï–°–ö–ò–ô –°–ú–´–°–õ
                                usdHidden.value = '';
                                pctHidden.value = '';
                                return;
                            }

                            // ===== USD / PCT =====
                            valueRO.classList.add('d-none');
                            valueNum.classList.remove('d-none');

                            if (m === 'USD') {
                                label.textContent = `–°—É–º–º–∞ (${asset})`;
                                valueNum.placeholder = '–ù–∞–ø—Ä. 500';
                                valueNum.max = '';
                                hint.textContent = `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤ ${asset}.`;
                            }

                            if (m === 'PCT') {
                                label.textContent = '–ü—Ä–æ—Ü–µ–Ω—Ç (%)';
                                valueNum.placeholder = '–ù–∞–ø—Ä. 50';
                                valueNum.max = '100';
                                hint.textContent = '–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞.';
                            }

                            syncHidden();
                        }

                        function syncHidden() {
                            const m = mode.value;
                            const raw = valueNum.value.trim();

                            if (!raw || m === 'NONE') {
                                usdHidden.value = '';
                                pctHidden.value = '';
                                preview.textContent = '–õ–∏–º–∏—Ç: –≤–µ—Å—å –±–∞–ª–∞–Ω—Å';
                                return;
                            }

                            const v = Number(raw);
                            if (!Number.isFinite(v) || v < 0) return;

                            if (m === 'USD') {
                                usdHidden.value = raw;
                                pctHidden.value = '';
                                preview.textContent = `–õ–∏–º–∏—Ç: ${raw} ${asset}`;
                            }

                            if (m === 'PCT') {
                                const clamped = Math.min(100, v);
                                pctHidden.value = String(clamped);
                                usdHidden.value = '';
                                valueNum.value = clamped;
                                preview.textContent = `–õ–∏–º–∏—Ç: ${clamped}%`;
                            }
                        }

                        mode.addEventListener('change', applyUi);
                        valueNum.addEventListener('input', syncHidden);

                    })();
                </script>







                <hr class="my-4"/>

                <div class="section-title">–ü—Ä–∏–±—ã–ª—å</div>

                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="form-check">
                            <input class="form-check-input"
                                   type="checkbox"
                                   id="reinvestProfit"
                                   name="reinvestProfit"
                                   value="true"
                                   th:checked="${strategy.reinvestProfit}"/>

                            <label class="form-check-label" for="reinvestProfit">
                                –†–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–±—ã–ª—å
                            </label>
                        </div>

                        <div class="form-text">
                            –ü—Ä–∏–±—ã–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–¥–µ–ª–∫–∞—Ö.
                        </div>
                    </div>
                </div>

                <hr class="my-4"/>

                <div class="section-title">–ö–æ–º–∏—Å—Å–∏–∏ –±–∏—Ä–∂–∏</div>

                <div class="row g-4 align-items-end">

                    <!-- MAKER -->
                    <div class="col-md-4">
                        <label class="form-label">–ö–æ–º–∏—Å—Å–∏—è Maker</label>

                        <div class="input-group">
                            <input class="form-control" readonly
                                   th:value="${(accountFees != null and accountFees.makerPct != null)
                        ? (#numbers.formatDecimal(accountFees.makerPct, 1, 'POINT', 4, 'POINT') + ' %')
                        : '‚Äî'}">
                            <span class="input-group-text">%</span>
                        </div>

                        <div class="form-text">
                            –ö–æ–º–∏—Å—Å–∏—è –∑–∞ –ª–∏–º–∏—Ç–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞ (maker).
                        </div>
                    </div>

                    <!-- TAKER -->
                    <div class="col-md-4">
                        <label class="form-label">–ö–æ–º–∏—Å—Å–∏—è Taker</label>

                        <div class="input-group">
                            <input class="form-control" readonly
                                   th:value="${(accountFees != null and accountFees.takerPct != null)
                        ? (#numbers.formatDecimal(accountFees.takerPct, 1, 'POINT', 4, 'POINT') + ' %')
                        : '‚Äî'}">
                            <span class="input-group-text">%</span>
                        </div>

                        <div class="form-text">
                            –ö–æ–º–∏—Å—Å–∏—è –∑–∞ —Ä—ã–Ω–æ—á–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞ (taker).
                        </div>
                    </div>

                    <!-- INFO -->
                    <div class="col-md-4">
                        <div class="alert alert-secondary small mb-0">
                            –ö–æ–º–∏—Å—Å–∏–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è —Å –±–∏—Ä–∂–∏ –∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
                            <span class="d-block mt-1"
                                  th:if="${accountFees == null}">
                –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö: –ø—Ä–æ–≤–µ—Ä—å API-–∫–ª—é—á–∏ –∏–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.
            </span>
                        </div>
                    </div>

                </div>


                <div class="d-flex justify-content-end mt-4">
                    <button type="submit"
                            class="btn btn-primary"
                            name="saveScope"
                            value="general">
                        ‚úî –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ¬´–û–±—â–∏–µ¬ª
                    </button>
                </div>
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const select = document.getElementById('accountAssetSelect');
                    const hidden = document.getElementById('accountAssetHidden');

                    if (select && hidden) {
                        select.addEventListener('change', () => {
                            hidden.value = select.value;
                            console.log('accountAsset changed ->', select.value);
                        });
                    }
                });
            </script>



            <!-- ====================== RISK TAB ===================== -->
            <div class="tab-pane" id="tab-risk">

                <!-- ================== DAILY / PER-TRADE LOSS ================== -->
                <div class="section-title">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ—Ç–µ—Ä—å</div>

                <div class="row g-4">
                    <div class="col-md-4">
                        <label class="form-label">
                            –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –∑–∞ –¥–µ–Ω—å (%)
                            <span class="badge bg-secondary ms-1">–õ–∏–º–∏—Ç</span>
                        </label>
                        <input type="number"
                               step="0.1"
                               min="0"
                               max="100"
                               class="form-control"
                               name="dailyLossLimitPct"
                               th:value="${strategy.dailyLossLimitPct}">
                        <div class="form-text">
                            –ï—Å–ª–∏ —Å—É–º–º–∞—Ä–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –∑–∞ –¥–µ–Ω—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî
                            –±–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç —Ç–æ—Ä–≥–æ–≤–ª—é –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è.
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">
                            –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –Ω–∞ –æ–¥–Ω—É —Å–¥–µ–ª–∫—É (%)
                            <span class="badge bg-info ms-1">AI</span>
                        </label>
                        <input type="number"
                               step="0.1"
                               min="0"
                               max="100"
                               class="form-control"
                               name="riskPerTradePct"
                               th:value="${strategy.riskPerTradePct}">
                        <div class="form-text">
                            –í–µ—Ä—Ö–Ω–∏–π –ø—Ä–µ–¥–µ–ª —Ä–∏—Å–∫–∞ –Ω–∞ –æ–¥–Ω—É —Å–¥–µ–ª–∫—É.
                            –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–æ–∂–µ—Ç —Å–Ω–∏–∂–∞—Ç—å —Ä–∏—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="alert alert-warning small mt-4">
                            –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 1‚Äì2% –Ω–∞ —Å–¥–µ–ª–∫—É –∏ –Ω–µ –±–æ–ª–µ–µ 5% –≤ –¥–µ–Ω—å.
                        </div>
                    </div>
                </div>

                <hr class="my-4"/>

                <!-- ================== COOLDOWN (AI / RUNTIME) ================== -->
                <div class="section-title">–ß–∞—Å—Ç–æ—Ç–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏</div>

                <div class="row g-4">
                    <div class="col-md-4">
                        <label class="form-label">
                            –¢–µ–∫—É—â–∞—è –ø–∞—É–∑–∞ (—Ä–∞—Å—á—ë—Ç AI)
                            <span class="badge bg-info ms-1">Runtime</span>
                        </label>

                        <!-- ‚ùó Runtime indicator ‚Äî –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è -->
                        <input type="number"
                               class="form-control"
                               value="30"
                               readonly>

                        <div class="form-text">
                            –ó–Ω–∞—á–µ–Ω–∏–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                            –∏ <b>–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è</b> –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="alert alert-secondary small mt-4">
                            –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã—Ö –≤—Ö–æ–¥–æ–≤
                            –∏ —Ö–∞–æ—Ç–∏—á–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏.
                        </div>
                    </div>
                </div>


                <hr class="my-4"/>

                <!-- ================== TP / SL ================== -->
                <div class="section-title">–ó–∞—â–∏—Ç–∞ –æ–¥–Ω–æ–π —Å–¥–µ–ª–∫–∏</div>

                <div class="row g-4">
                    <div class="col-md-4">
                        <label class="form-label">
                            Stop Loss (%)
                            <span class="badge bg-danger ms-1">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
                        </label>
                        <input type="number"
                               step="0.1"
                               min="0.1"
                               class="form-control"
                               name="stopLossPct"
                               th:value="${strategy.stopLossPct}">
                        <div class="form-text">
                            –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∑–∞—â–∏—Ç—ã.
                            –ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á—ë–Ω.
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">
                            Take Profit (%)
                            <span class="badge bg-info ms-1">AI</span>
                        </label>
                        <input type="number"
                               step="0.1"
                               min="0"
                               class="form-control"
                               name="takeProfitPct"
                               th:value="${strategy.takeProfitPct}">
                        <div class="form-text">
                            –ë–∞–∑–æ–≤—ã–π –æ—Ä–∏–µ–Ω—Ç–∏—Ä –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –ø—Ä–∏–±—ã–ª–∏.
                            –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç—å —Å–¥–µ–ª–∫—É —Ä–∞–Ω—å—à–µ.
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">
                            –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ (%)
                            <span class="badge bg-info ms-1">AI</span>
                        </label>
                        <!-- ‚ùó RUNTIME / –ù–ï –°–û–•–†–ê–ù–Ø–ï–¢–°–Ø -->
                        <input type="number"
                               step="0.01"
                               class="form-control"
                               placeholder="0.20"
                               readonly>
                        <div class="form-text">
                            –£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏—Å—Ç–µ–º–æ–π.
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-end mt-4">
                    <button type="submit"
                            class="btn btn-primary"
                            name="saveScope"
                            value="risk">
                        ‚úî –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ¬´–†–∏—Å–∫¬ª
                    </button>
                </div>

            </div>

            <!-- ====================== TRADE TAB ==================== -->
            <div class="tab-pane" id="tab-trade">

                <!-- ================== INSTRUMENT ================== -->
                <div class="section-title">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ç–æ—Ä–≥–æ–≤–ª–∏</div>

                <div class="col-md-4">

                    <label class="form-label">
                        –¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞
                        <span class="badge bg-secondary ms-1">–†—ã–Ω–æ–∫</span>
                    </label>

                    <!-- ================= MODE SWITCH ================= -->
                    <div class="btn-group btn-group-sm mb-2 w-100" role="group">
                        <button type="button"
                                class="btn btn-outline-secondary active"
                                data-symbol-mode="POPULAR">
                            –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ
                        </button>
                        <button type="button"
                                class="btn btn-outline-secondary"
                                data-symbol-mode="GAINERS">
                            –†–∞—Å—Ç—É—â–∏–µ
                        </button>
                        <button type="button"
                                class="btn btn-outline-secondary"
                                data-symbol-mode="LOSERS">
                            –ü–∞–¥–∞—é—â–∏–µ
                        </button>
                    </div>

                    <!-- ================= SYMBOL PICKER ================= -->
                    <div class="dropdown">

                        <!-- –í–ê–ñ–ù–û: div.form-control ‚Äî —á—Ç–æ–±—ã –≤—ã–≥–ª—è–¥–µ–ª –∫–∞–∫ input -->
                        <div id="symbolDropdown"
                             class="form-control strategy-input dropdown-toggle text-start"
                             data-bs-toggle="dropdown"
                             aria-expanded="false"
                             role="button"
                             tabindex="0">

            <span id="symbolLabel"
                  th:text="${strategy.symbol != null ? strategy.symbol : '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—É—é –ø–∞—Ä—É'}">
            </span>
                        </div>

                        <ul class="dropdown-menu w-100 strategy-dropdown" id="symbolList">
                            <!-- —Å–ø–∏—Å–æ–∫ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ JS -->
                        </ul>
                    </div>

                    <!-- —Ä–µ–∞–ª—å–Ω–æ —É—Ö–æ–¥–∏—Ç –≤ POST -->
                    <input type="hidden"
                           name="symbol"
                           id="symbolHidden"
                           th:value="${strategy.symbol}">

                    <div class="form-text">
                        –ü–∞—Ä–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –±–æ—Ç –±—É–¥–µ—Ç —Å–æ–≤–µ—Ä—à–∞—Ç—å —Å–¥–µ–ª–∫–∏.
                    </div>

                </div>

                <hr class="my-4"/>

                <!-- ================== TIMEFRAME ================== -->
                <div class="section-title">–¢–∞–π–º—Ñ—Ä–µ–π–º</div>

                <div class="row g-4">
                    <div class="col-md-4">
                        <label class="form-label"
                               th:text="${strategy.advancedControlMode.name() == 'AI'
                    ? '–ë–∞–∑–æ–≤—ã–π —Ç–∞–π–º—Ñ—Ä–µ–π–º (fallback)'
                    : (strategy.advancedControlMode.name() == 'HYBRID'
                        ? '–ë–∞–∑–æ–≤—ã–π —Ç–∞–π–º—Ñ—Ä–µ–π–º (AI –º–æ–∂–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å)'
                        : '–¢–∞–π–º—Ñ—Ä–µ–π–º —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏')}">
                            –¢–∞–π–º—Ñ—Ä–µ–π–º —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
                        </label>

                        <!-- ‚úÖ AI: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π TF (read-only) -->
                        <div class="form-control"
                             th:if="${strategy.advancedControlMode.name() == 'AI'}"
                             th:text="${aiTimeframe != null ? aiTimeframe : (strategy.timeframe != null ? strategy.timeframe : '1m')}"
                             style="cursor: not-allowed; opacity: .85;">
                        </div>

                        <!-- ‚úÖ MANUAL / HYBRID: –æ–±—ã—á–Ω—ã–π select -->
                        <select class="form-select"
                                name="timeframe"
                                th:if="${strategy.advancedControlMode.name() != 'AI'}"
                                required>

                            <option th:if="${availableTimeframes == null || #lists.isEmpty(availableTimeframes)}"
                                    th:value="${strategy.timeframe != null ? strategy.timeframe : '1m'}"
                                    th:text="${strategy.timeframe != null ? strategy.timeframe : '1m'}">
                            </option>

                            <option th:each="tf : ${availableTimeframes}"
                                    th:value="${tf}"
                                    th:text="${tf}"
                                    th:selected="${tf == strategy.timeframe}">
                            </option>
                        </select>

                        <!-- ‚úÖ AI: select —Å–∫—Ä—ã–≤–∞–µ–º, –Ω–æ fallback timeframe –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —É—Ö–æ–¥–∏—Ç –≤ POST -->
                        <input type="hidden"
                               name="timeframe"
                               th:value="${strategy.timeframe != null ? strategy.timeframe : '1m'}"
                               th:if="${strategy.advancedControlMode.name() == 'AI'}"/>

                        <div class="form-text"
                             th:text="${strategy.advancedControlMode.name() == 'AI'
                  ? '–°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∞–π–º—Ñ—Ä–µ–π–º, –≤—ã–±—Ä–∞–Ω–Ω—ã–π AI. –í –ë–î —Ö—Ä–∞–Ω–∏—Ç—Å—è –±–∞–∑–æ–≤—ã–π (fallback).'
                  : (strategy.advancedControlMode.name() == 'HYBRID'
                      ? 'AI –º–æ–∂–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å, –Ω–æ –º–µ–Ω—è—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é.'
                      : '–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–π–º—Ñ—Ä–µ–π–º.')}">
                        </div>
                    </div>

                    <div class="col-md-8" th:if="${strategy.advancedControlMode.name() == 'AI'}">
                        <div class="alert alert-info small mt-4">
                            –¢–∞–π–º—Ñ—Ä–µ–π–º –≤ —Ä–∞–Ω—Ç–∞–π–º–µ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è AI. –ó–Ω–∞—á–µ–Ω–∏–µ –≤ –±–∞–∑–µ ‚Äî —Ç–æ–ª—å–∫–æ fallback.
                        </div>
                    </div>
                </div>

                <hr class="my-4"/>

                <!-- ================== HISTORY / DATA ================== -->
                <div class="section-title">–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</div>

                <div class="row g-4">
                    <div class="col-md-4">
                        <label class="form-label">
                            –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π
                            <span class="badge bg-secondary ms-1">–î–∞–Ω–Ω—ã–µ</span>
                        </label>

                        <input type="number"
                               class="form-control"
                               name="cachedCandlesLimit"
                               min="50"
                               step="50"
                               th:value="${strategy.cachedCandlesLimit}"
                               placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 500">

                        <div class="form-text">
                            –°–∫–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–≤–µ—á–µ–π –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
                            –ë–æ–ª—å—à–µ ‚Äî —Ç–æ—á–Ω–µ–µ, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ.
                        </div>
                    </div>
                </div>


                <hr class="my-4"/>

                <!-- ================== EXCHANGE LIMITS ================== -->
                <div class="section-title">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–∏—Ä–∂–∏</div>

                <!-- ================== EXCHANGE LIMITS (UX+) ================== -->
                <div class="section-title d-flex align-items-center justify-content-between">
                    <span class="badge bg-secondary">–ë–∏—Ä–∂–∞</span>
                </div>

                <div class="row g-4">

                    <!-- MIN NOTIONAL -->
                    <div class="col-md-3">
                        <label class="form-label d-flex align-items-center gap-2">
                            <i class="bi bi-cash-coin"></i>
                            <span>–ú–∏–Ω. —Å—É–º–º–∞</span>
                        </label>

                        <input id="exMinNotional"
                               class="form-control"
                               readonly
                               value="‚Äî">

                        <div class="d-flex align-items-center gap-2 mt-1">
            <span id="exMinNotionalScope"
                  class="badge bg-secondary">
                ‚Äî
            </span>
                            <small class="text-muted">
                                –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ —Å–¥–µ–ª–∫–∏
                            </small>
                        </div>

                        <div class="form-text">
                            –ù–∏–∂–µ —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –±–∏—Ä–∂–∞ –æ—Ç–∫–ª–æ–Ω–∏—Ç –æ—Ä–¥–µ—Ä.
                        </div>
                    </div>

                    <!-- STEP SIZE -->
                    <div class="col-md-3">
                        <label class="form-label d-flex align-items-center gap-2">
                            <i class="bi bi-bounding-box"></i>
                            <span>–®–∞–≥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞</span>
                        </label>

                        <input id="exStepSize"
                               class="form-control"
                               readonly
                               value="‚Äî">

                        <div class="d-flex align-items-center gap-2 mt-1">
            <span id="exStepSizeScope"
                  class="badge bg-secondary">
                ‚Äî
            </span>
                            <small class="text-muted">
                                –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                            </small>
                        </div>

                        <div class="form-text">
                            –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É–¥–µ—Ç –æ–∫—Ä—É–≥–ª–µ–Ω–æ –ø–æ–¥ —ç—Ç–æ—Ç —à–∞–≥.
                        </div>
                    </div>

                    <!-- TICK SIZE -->
                    <div class="col-md-3">
                        <label class="form-label d-flex align-items-center gap-2">
                            <i class="bi bi-tag"></i>
                            <span>–®–∞–≥ —Ü–µ–Ω—ã</span>
                        </label>

                        <input id="exTickSize"
                               class="form-control"
                               readonly
                               value="‚Äî">

                        <div class="d-flex align-items-center gap-2 mt-1">
            <span id="exTickSizeScope"
                  class="badge bg-secondary">
                ‚Äî
            </span>
                            <small class="text-muted">
                                –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã
                            </small>
                        </div>

                        <div class="form-text">
                            –¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫—Ä–∞—Ç–Ω–∞ —ç—Ç–æ–º—É —à–∞–≥—É.
                        </div>
                    </div>

                    <!-- MAX ORDERS -->
                    <div class="col-md-3">
                        <label class="form-label d-flex align-items-center gap-2">
                            <i class="bi bi-stack"></i>
                            <span>–õ–∏–º–∏—Ç –æ—Ä–¥–µ—Ä–æ–≤</span>
                        </label>

                        <input id="exMaxOrders"
                               class="form-control"
                               readonly
                               value="‚Äî">

                        <div class="d-flex align-items-center gap-2 mt-1">
            <span id="exMaxOrdersScope"
                  class="badge bg-secondary">
                ‚Äî
            </span>
                            <small class="text-muted">
                                –ê–∫—Ç–∏–≤–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞
                            </small>
                        </div>

                        <div class="form-text">
                            –ú–∞–∫—Å–∏–º—É–º –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ –ø–æ —Å–∏–º–≤–æ–ª—É.
                        </div>
                    </div>

                </div>

                <div class="alert alert-secondary small mt-3 d-flex gap-2 align-items-start">
                    <i class="bi bi-info-circle mt-1"></i>
                    <div>
                        –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–∞—é—Ç—Å—è –±–∏—Ä–∂–µ–π –∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω—ã.
                        –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ü–µ–Ω—É/–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥ —à–∞–≥–∏ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã.
                    </div>
                </div>

                <hr class="my-4"/>

                <!-- ================== SAFETY & FLOW CONTROL ================== -->
                <div class="section-title">–ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–∏—Å–∫–∞ –∏ —á–∞—Å—Ç–æ—Ç—ã</div>

                <div class="row g-4">

                    <!-- MAX OPEN ORDERS -->
                    <div class="col-md-4">
                        <label class="form-label">
                            –ú–∞–∫—Å–∏–º—É–º –æ—Ç–∫—Ä—ã—Ç—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤
                            <span class="badge bg-secondary ms-1">–°—Ç—Ä–∞—Ç–µ–≥–∏—è</span>
                        </label>

                        <input type="number"
                               class="form-control"
                               name="maxOpenOrders"
                               min="1"
                               step="1"
                               inputmode="numeric"
                               th:value="${strategy.maxOpenOrders}"
                               placeholder="–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è">

                        <div class="form-text">
                            –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤.
                            –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º ‚Äî –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.
                        </div>
                    </div>

                    <!-- COOLDOWN -->
                    <div class="col-md-4">
                        <label class="form-label">
                            –ü–∞—É–∑–∞ –ø–æ—Å–ª–µ —Å–¥–µ–ª–∫–∏ (—Å–µ–∫)
                            <span class="badge bg-secondary ms-1">–°—Ç—Ä–∞—Ç–µ–≥–∏—è</span>
                        </label>

                        <input type="number"
                               class="form-control"
                               id="cooldownSecondsInput"
                               name="cooldownSeconds"
                               min="0"
                               max="86400"
                               step="1"
                               inputmode="numeric"
                               autocomplete="off"
                               th:attr="value=${strategy.cooldownSeconds}"
                               placeholder="–ù–∞–ø—Ä. 30 (–ø—É—Å—Ç–æ = –±–µ–∑ –ø–∞—É–∑—ã)">


                        <div class="form-text">
                            –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–∞—É–∑–∞ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –≤—Ö–æ–¥–æ–º.
                            –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –∏–ª–∏ 0 ‚Äî –±–µ–∑ –ø–∞—É–∑—ã.
                        </div>
                    </div>


                </div>




                <div class="d-flex justify-content-end mt-4">
                    <button type="submit"
                            class="btn btn-primary"
                            name="saveScope"
                            value="trade">
                        ‚úî –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ¬´–¢–æ—Ä–≥–æ–≤–ª—è¬ª
                    </button>
                </div>

            </div>


            <!-- ====================== ADVANCED TAB ================= -->
            <div class="tab-pane" id="tab-advanced">

                <div class="section-title">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ: —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏ AI</div>

                <div class="alert alert-secondary small">
                    –ó–¥–µ—Å—å –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
                    –ï—Å–ª–∏ –≤—ã –Ω–µ —É–≤–µ—Ä–µ–Ω—ã ‚Äî –æ—Å—Ç–∞–≤—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
                </div>

                <!-- ================== CONTROL MODE ================== -->
                <div class="section-title mt-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏</div>

                <div class="row g-4">
                    <div class="col-md-4">
                        <label class="form-label">–ö—Ç–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏</label>

                        <select class="form-select" name="advancedControlMode">
                            <option value="MANUAL"
                                    th:selected="${strategy != null and strategy.advancedControlMode != null and strategy.advancedControlMode.name() == 'MANUAL'}">
                                –†—É—á–Ω–æ–π (—Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
                            </option>

                            <option value="HYBRID"
                                    th:selected="${strategy != null and strategy.advancedControlMode != null and strategy.advancedControlMode.name() == 'HYBRID'}">
                                –ì–∏–±—Ä–∏–¥ (AI –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç)
                            </option>

                            <option value="AI"
                                    th:selected="${strategy != null and strategy.advancedControlMode != null and strategy.advancedControlMode.name() == 'AI'}">
                                –ê–≤—Ç–æ (AI —É–ø—Ä–∞–≤–ª—è–µ—Ç)
                            </option>
                        </select>

                        <div class="form-text">
                            –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫—Ç–æ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
                        </div>
                    </div>

                    <div class="col-md-8">
                        <div class="alert alert-info small mt-4">
                            –í —Ä–µ–∂–∏–º–∞—Ö <b>–ì–∏–±—Ä–∏–¥</b> –∏ <b>–ê–≤—Ç–æ</b> –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–≥—É—Ç
                            –∏–∑–º–µ–Ω—è—Ç—å—Å—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –≤ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö.
                        </div>
                    </div>
                </div>


                <hr class="my-4"/>

                <!-- ================== STRATEGY-SPECIFIC ================== -->
                <div class="section-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</div>

                <div class="alert alert-dark small mb-3">
                    <b>–°—Ç—Ä–∞—Ç–µ–≥–∏—è:</b>
                    <span th:text="${type}">TYPE</span><br/>
                    –ù–∏–∂–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.
                </div>

                <div th:if="${strategyAdvancedHtml != null}"
                     th:utext="${strategyAdvancedHtml}">
                </div>

                <div th:if="${strategyAdvancedHtml == null}"
                     class="alert alert-secondary small">
                    –î–ª—è —ç—Ç–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
                </div>

                <hr class="my-4"/>

                <!-- ================== AI / OPTIMIZATION (FUTURE) ================== -->
                <div class="section-title">AI –∏ –∞–≤—Ç–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è</div>

                <div class="alert alert-warning small">
                    –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ–∑–∂–µ.
                    –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∫–∞–∑–∞–Ω –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –±—É–¥—É—â–∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.
                </div>

                <div class="row g-4">
                    <div class="col-md-4">
                        <label class="form-label">–†–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è</label>
                        <select class="form-select" disabled>
                            <option>–í—ã–∫–ª—é—á–µ–Ω–æ</option>
                            <option>–°–∏–º—É–ª—è—Ü–∏—è (paper)</option>
                            <option>Live</option>
                        </select>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">–ü–µ—Ä–∏–æ–¥ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è (—á–∞—Å—ã)</label>
                        <input type="number"
                               class="form-control"
                               disabled
                               placeholder="–ù–∞–ø—Ä. 12">
                    </div>

                    <div class="col-md-4">
                        <label class="form-label">–ú–µ—Ç—Ä–∏–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</label>
                        <select class="form-select" disabled>
                            <option>PnL</option>
                            <option>Sharpe</option>
                            <option>–ü—Ä–æ—Å–∞–¥–∫–∞</option>
                        </select>
                    </div>
                </div>

                <hr class="my-4"/>

                <!-- ================== CHANGE HISTORY ================== -->
                <div class="section-title">–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</div>

                <div class="row g-4">
                    <div class="col-md-6">
                        <label class="form-label">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ</label>
                        <input class="form-control" readonly value="‚Äî">
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">–ò—Å—Ç–æ—á–Ω–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è</label>
                        <input class="form-control" readonly value="‚Äî">
                    </div>
                </div>

                <div class="d-flex justify-content-end mt-4">
                    <button type="submit"
                            class="btn btn-primary"
                            name="saveScope"
                            value="advanced">
                        ‚úî –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ¬´–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ¬ª
                    </button>
                </div>

            </div>


        </form>

    </div> <!-- /tab-content -->
    <!-- ===================================================== -->
    <!-- NETWORK TAB: JS -->
    <!-- ===================================================== -->

</div>
