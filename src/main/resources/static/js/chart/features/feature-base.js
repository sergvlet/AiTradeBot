"use strict";

/**
 * FeatureBase (–®–ê–ì 1)
 * -------------------
 * –ë–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –≤—Å–µ—Ö chart-features.
 *
 * –ö–æ–Ω—Ç—Ä–∞–∫—Ç:
 *   constructor({ layers })
 *   onEvent(ev)
 *   clear()
 *
 * –ü—Ä–∏–Ω—Ü–∏–ø—ã:
 * - Feature –ù–ï –∑–Ω–∞–µ—Ç –ø—Ä–æ chart-controller, WS, —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
 * - Feature —É–º–µ–µ—Ç —Ç–æ–ª—å–∫–æ:
 *    1) –ø–æ–ª—É—á–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ
 *    2) –¥–µ—Ä–≥–∞—Ç—å layers.* (–æ—Ç—Ä–∏—Å–æ–≤–∫–∞)
 *    3) —á–∏—Å—Ç–∏—Ç—å —Å–≤–æ–∏ —Å–ª–µ–¥—ã
 */
export class FeatureBase {

    /**
     * @param {{ layers: Object }} deps
     */
    constructor({ layers } = {}) {
        // LayerRenderer (–∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π –æ–±—ä–µ–∫—Ç)
        this.layers = layers || null;

        // –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏/–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏: –≤–∫–ª—é—á–∞—Ç—å –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ñ–∏—á–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        this.debug = false;
        this.name = this.constructor?.name || "Feature";
    }

    /**
     * –ì–ª–∞–≤–Ω—ã–π –≤—Ö–æ–¥: —Å–æ–±—ã—Ç–∏–µ –ª—é–±–æ–≥–æ —Ç–∏–ø–∞.
     * –ö–∞–∂–¥–∞—è —Ñ–∏—á–∞ –°–ê–ú–ê —Ä–µ—à–∞–µ—Ç, –∫–∞–∫–∏–µ ev.type –µ–π –Ω—É–∂–Ω—ã.
     *
     * @param {Object} ev
     */
    onEvent(ev) {
        // –±–∞–∑–æ–≤–∞—è —Ñ–∏—á–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç
        // (–Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç)
    }

    /**
     * –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë, —á—Ç–æ —ç—Ç–∞ —Ñ–∏—á–∞ –Ω–∞—Ä–∏—Å–æ–≤–∞–ª–∞/—Å–æ–∑–¥–∞–ª–∞.
     * –ù–∏–∫–∞–∫–∏—Ö –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ñ–∏—á.
     */
    clear() {
        // –±–∞–∑–æ–≤–∞—è —Ñ–∏—á–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç
        // (–Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç)
    }

    // =====================================================
    // HELPERS (–¥–ª—è –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤)
    // =====================================================

    /**
     * –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ layers.*
     * –ù–µ –¥–∞—ë—Ç –ø–∞–¥–∞—Ç—å –≤—Å–µ–º—É –ø–∞–π–ø–ª–∞–π–Ω—É –∏–∑-–∑–∞ –æ–¥–Ω–æ–π —Ñ–∏—á–∏.
     *
     * @param {string} methodName
     * @param  {...any} args
     * @returns {any}
     */
    callLayer(methodName, ...args) {
        if (!this.layers) return;

        const fn = this.layers[methodName];
        if (typeof fn !== "function") return;

        try {
            return fn.apply(this.layers, args);
        } catch (e) {
            // –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –Ω–µ –±—Ä–æ—Å–∞–µ–º –æ—à–∏–±–∫—É –¥–∞–ª—å—à–µ
            if (this.debug) {
                console.warn(`‚ö† ${this.name}: layers.${methodName} failed`, e);
            }
        }
    }

    /**
     * –ë—ã—Å—Ç—Ä—ã–π –ª–æ–≥–≥–µ—Ä –¥–ª—è —Ñ–∏—á (–≤–∫–ª—é—á–∞–µ—Ç—Å—è this.debug = true).
     */
    log(...args) {
        if (!this.debug) return;
        console.log(`üß© ${this.name}:`, ...args);
    }
}
